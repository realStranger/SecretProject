{"remainingRequest":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/thread-loader/dist/cjs.js!/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/babel-loader/lib/index.js!/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/src/components/Chat.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/src/components/Chat.vue","mtime":1596108899440},{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7Cm1vbWVudC5sb2NhbGUoJ3J1Jyk7CndpbmRvdy5tb21lbnQgPSBtb21lbnQ7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnQ2hhdCcsCiAgcHJvcHM6IHsKICAgIGNsYWltSWQ6IHsKICAgICAgdHlwZTogTnVtYmVyLAogICAgICBkZWZhdWx0OiAwCiAgICB9LAogICAgb3JkZXJJZDogewogICAgICB0eXBlOiBOdW1iZXIsCiAgICAgIGRlZmF1bHQ6IDAKICAgIH0sCiAgICB1c2VyRGF0YTogewogICAgICB0eXBlOiBPYmplY3QsCiAgICAgIGRlZmF1bHQ6IGZ1bmN0aW9uIF9kZWZhdWx0KCkgewogICAgICAgIHJldHVybiB7fTsKICAgICAgfQogICAgfQogIH0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHByZXBhcmVkRmlsZXM6IFtdLAogICAgICBpdGVtczogW10sCiAgICAgIHRleHQ6ICcnCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGl0ZW1zQnlEYXRlOiBmdW5jdGlvbiBpdGVtc0J5RGF0ZSgpIHsKICAgICAgdmFyIGl0ZW1zQnlEYXRlID0ge30sCiAgICAgICAgICBpdGVtLAogICAgICAgICAgbSwKICAgICAgICAgIGRhdGU7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaXRlbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpdGVtID0gdGhpcy5pdGVtc1tpXTsKICAgICAgICBtID0gbW9tZW50LnVuaXgoaXRlbS50aW1lc3RhbXApOwogICAgICAgIGRhdGUgPSBtLmZvcm1hdCgnREQgTU1NTSBZWVlZJyk7CgogICAgICAgIGlmICghaXRlbXNCeURhdGVbZGF0ZV0pIHsKICAgICAgICAgIGl0ZW1zQnlEYXRlW2RhdGVdID0gW107CiAgICAgICAgfQoKICAgICAgICBpdGVtLnRpbWVGb3JtYXQgPSBtLmZvcm1hdCgnSEg6bW0nKTsKICAgICAgICBpdGVtc0J5RGF0ZVtkYXRlXS5wdXNoKGl0ZW0pOwogICAgICB9CgogICAgICByZXR1cm4gaXRlbXNCeURhdGU7CiAgICB9CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLmxvYWREYXRhKCk7CiAgICB9LCA1MDAwKTsKICAgICQoJy5sYy1jb250JykuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBzdGlja3kgPSAkKCcuY2hhdC1vcGVuLWJ0bicpOwogICAgICB2YXIgc3RpY2t5V3JhcCA9ICQoJy5sYy1jb250Jyk7CiAgICAgICQod2luZG93KS5zY3JvbGwoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBuc2MgPSAkKGRvY3VtZW50KS5zY3JvbGxUb3AoKTsKICAgICAgICB2YXIgYnAxID0gc3RpY2t5V3JhcC5vZmZzZXQoKS50b3A7CiAgICAgICAgdmFyIGJwMiA9IGJwMSArIHN0aWNreVdyYXAub3V0ZXJIZWlnaHQoKSAtICQod2luZG93KS5oZWlnaHQoKTsKCiAgICAgICAgaWYgKG5zYyA+IGJwMSkgewogICAgICAgICAgc3RpY2t5LmNzcygncG9zaXRpb24nLCAnZml4ZWQnKTsKICAgICAgICAgIHN0aWNreS5hZGRDbGFzcygnZml4ZWQnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RpY2t5LmNzcygncG9zaXRpb24nLCAnYWJzb2x1dGUnKTsKICAgICAgICAgIHN0aWNreS5jc3MoJ3RvcCcsICcwICFpbXBvcnRhbnQnKTsKICAgICAgICAgIHN0aWNreS5yZW1vdmVDbGFzcygnZml4ZWQnKTsKICAgICAgICB9CgogICAgICAgIGlmIChuc2MgPiBicDIpIHsKICAgICAgICAgIHN0aWNreS5jc3MoJ3RvcCcsIGJwMiAtIG5zYyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0aWNreS5jc3MoJ3RvcCcsICcyNDVweCcpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICAgICQoJy5jaGF0LW9wZW4tYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAkKCcuY2hhdCcpLnRvZ2dsZUNsYXNzKCdhY3RpdmUnKTsKICAgIH0pOwogICAgJCgnLmNoYXQtY2xvc2UnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICQoJy5jaGF0JykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOwogICAgfSk7CiAgICAkKCcuY2hhdC10b2dnbGUnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICQoJy5jaGF0LWJvZHknKS5zbGlkZVRvZ2dsZSgpOwogICAgfSk7CiAgICAkKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGhlaWdodFRvQm90dG9tRWRnZSA9ICQod2luZG93KS5zY3JvbGxUb3AoKSArIHdpbmRvdy5pbm5lckhlaWdodDsKICAgICAgdmFyIGNhblNlZUZvb3RlciA9IGhlaWdodFRvQm90dG9tRWRnZSA+ICQoJy5mb290ZXInKS5vZmZzZXQoKS50b3A7CgogICAgICBpZiAoY2FuU2VlRm9vdGVyICYmICF3aW5kb3cuYWJzb2x1dGVkKSB7CiAgICAgICAgJCgnLmNoYXQnKS50b2dnbGVDbGFzcygnYWJzb2x1dGUnKTsKICAgICAgICAkKCcuY2hhdCcpLnRvZ2dsZUNsYXNzKCdmaXhlZCcpOwogICAgICAgIHdpbmRvdy5hYnNvbHV0ZWQgPSB0cnVlOwogICAgICB9CgogICAgICBpZiAoIWNhblNlZUZvb3RlciAmJiB3aW5kb3cuYWJzb2x1dGVkKSB7CiAgICAgICAgJCgnLmNoYXQnKS50b2dnbGVDbGFzcygnYWJzb2x1dGUnKTsKICAgICAgICAkKCcuY2hhdCcpLnRvZ2dsZUNsYXNzKCdmaXhlZCcpOwogICAgICAgIHdpbmRvdy5hYnNvbHV0ZWQgPSBmYWxzZTsKICAgICAgfQogICAgfSk7CiAgfSwKICB3YXRjaDogewogICAgaXRlbXM6IGZ1bmN0aW9uIGl0ZW1zKG1lc3NhZ2VzLCBvbGRNZXNzYWdlcykgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIGlmIChtZXNzYWdlcy5sZW5ndGggIT0gb2xkTWVzc2FnZXMubGVuZ3RoKSB7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczIuJGVsLnF1ZXJ5U2VsZWN0b3IoJy5jaGF0LWNvbnRlbnQnKS5zY3JvbGxUb3AgPSBfdGhpczIuJGVsLnF1ZXJ5U2VsZWN0b3IoJy5jaGF0LWNvbnRlbnQnKS5zY3JvbGxIZWlnaHQgLSBfdGhpczIuJGVsLnF1ZXJ5U2VsZWN0b3IoJy5jaGF0LWNvbnRlbnQnKS5jbGllbnRIZWlnaHQ7CiAgICAgICAgfSwgMzAwKTsKICAgICAgfQogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgbG9hZERhdGE6IGZ1bmN0aW9uIGxvYWREYXRhKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIEJYLmFqYXgucnVuQ29tcG9uZW50QWN0aW9uKCd4cGFnZTphamF4JywgJ2NoYXRMb2FkRGF0YScsIHsKICAgICAgICBtb2RlOiAnY2xhc3MnLAogICAgICAgIGRhdGE6IHsKICAgICAgICAgIGNsYWltSWQ6IHRoaXMuY2xhaW1JZCwKICAgICAgICAgIG9yZGVySWQ6IHRoaXMub3JkZXJJZAogICAgICAgIH0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuaXRlbXMgJiYgcmVzcG9uc2UuZGF0YS5pdGVtcy5sZW5ndGgpIHsKICAgICAgICAgICAgdmFyIHVucmVhZE1zZ0lkcyA9IFtdOwogICAgICAgICAgICB2YXIgaXRlbXMgPSByZXNwb25zZS5kYXRhLml0ZW1zOwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmIChpdGVtc1tpXS5VRl9SRUFEX1VTRVJfSUQpIHsKICAgICAgICAgICAgICAgIGl0ZW1zW2ldLlVGX1JFQURfVVNFUl9JRCA9IGl0ZW1zW2ldLlVGX1JFQURfVVNFUl9JRC5tYXAoZnVuY3Rpb24gKHYpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICt2OwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoIWl0ZW1zW2ldLlVGX1JFQURfVVNFUl9JRCB8fCAhfml0ZW1zW2ldLlVGX1JFQURfVVNFUl9JRC5pbmRleE9mKCtfdGhpczMudXNlckRhdGEuSUQpKSB7CiAgICAgICAgICAgICAgICB1bnJlYWRNc2dJZHMucHVzaChpdGVtc1tpXS5JRCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBfdGhpczMuaXRlbXMgPSBpdGVtczsKCiAgICAgICAgICAgIGlmICh1bnJlYWRNc2dJZHMubGVuZ3RoICYmIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jaGF0LWJvZHknKS5vZmZzZXRQYXJlbnQpIHsKICAgICAgICAgICAgICBfdGhpczMuc2V0TWVzc2FnZXNSZWFkKHVucmVhZE1zZ0lkcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIHNldE1lc3NhZ2VzUmVhZDogZnVuY3Rpb24gc2V0TWVzc2FnZXNSZWFkKCkgewogICAgICB2YXIgaWQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IFtdOwoKICAgICAgaWYgKGlkLmxlbmd0aCkgewogICAgICAgIEJYLmFqYXgucnVuQ29tcG9uZW50QWN0aW9uKCd4cGFnZTphamF4JywgJ2NoYXRTZXRNZXNzYWdlc1JlYWQnLCB7CiAgICAgICAgICBtb2RlOiAnY2xhc3MnLAogICAgICAgICAgZGF0YTogewogICAgICAgICAgICBpZDogaWQKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge30pOwogICAgICB9CiAgICB9LAogICAgYWRkTWVzc2FnZTogZnVuY3Rpb24gYWRkTWVzc2FnZSgpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICB2YXIgZmlsZUlucHV0ID0gdGhpcy4kZWwucXVlcnlTZWxlY3RvcignI2NoYXQtZmlsZScpOwogICAgICB2YXIgZGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICBkYXRhLmFwcGVuZCgnb3JkZXJJZCcsIHRoaXMub3JkZXJJZCk7CiAgICAgIGRhdGEuYXBwZW5kKCdjbGFpbUlkJywgdGhpcy5jbGFpbUlkKTsKICAgICAgZGF0YS5hcHBlbmQoJ3RleHQnLCB0aGlzLnRleHQpOwoKICAgICAgaWYgKGZpbGVJbnB1dC5maWxlcyAmJiBmaWxlSW5wdXQuZmlsZXMubGVuZ3RoKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaWxlSW5wdXQuZmlsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGRhdGEuYXBwZW5kKCdmaWxlW10nLCBmaWxlSW5wdXQuZmlsZXNbaV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgQlguYWpheC5ydW5Db21wb25lbnRBY3Rpb24oJ3hwYWdlOmFqYXgnLCAnY2hhdEFkZE1lc3NhZ2UnLCB7CiAgICAgICAgbW9kZTogJ2NsYXNzJywKICAgICAgICBkYXRhOiBkYXRhCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgX3RoaXM0LnRleHQgPSAnJzsKCiAgICAgICAgX3RoaXM0LmxvYWREYXRhKCk7CgogICAgICAgIF90aGlzNC4kcmVmcy50ZXh0QXJlYS5jbGVhcigpOwoKICAgICAgICBfdGhpczQucHJlcGFyZWRGaWxlcyA9IFtdOwogICAgICAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnOwogICAgICB9KTsKICAgIH0KICB9Cn07"},{"version":3,"sources":["Chat.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n    <div class=\"\">\n        <div class=\"chat-open-btn\">\n            <img src=\"/local/templates/mossman2018/img/ico-chat.svg\" alt=\"\">\n        </div>\n        <div class=\"chat fixed active\">\n            <div class=\"chat-header\">\n                <div class=\"chat-title\">Комментарии</div>\n                <div class=\"chat-btn\">\n                    <div class=\"chat-toggle\"><img src=\"/local/templates/mossman2018/img/ico-toggle-chat.svg\" alt=\"\"></div>\n                    <div class=\"chat-close\"><img src=\"/local/templates/mossman2018/img/ico-close-chat.svg\" alt=\"\"></div>\n                </div>\n            </div>\n            <div class=\"chat-body\">\n                <div class=\"chat-content\">\n                    <div v-for=\"(dateItems, date) in itemsByDate\" :key=\"date\" class=\"chat-items\">\n                        <div class=\"chat-date\"><span>{{ date }}</span></div>\n                        <div v-for=\"item in dateItems\" :key=\"item.ID\"\n                        class=\"chat-item\"\n                        :class=\"{\n                            'message-in' : item.UF_USER_ID != userData.ID && item.UF_USER_CODE != userData.XML_ID,\n                            'message-out' : item.UF_USER_ID == userData.ID || item.UF_USER_CODE == userData.XML_ID,\n                            }\"\n                            >\n                            <div class=\"sender-name color-text\">{{ [ item.USER_LAST_NAME, item.NAME, item.USER_SECOND_NAME, ].filter(v=>v).join(' ') }}</div>\n                            <div class=\"message-text\">\n                                {{ item.UF_TEXT }}\n                                <div v-if=\"item.files && item.files.length\" class=\"message-attach\">\n                                    <div v-for=\"file in item.files\" :key=\"file.id\" class=\"message-attach__item\">\n                                        <a :href=\"file.src\" target=\"_blank\" >{{ file.filename }}</a>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class=\"message-time\"><span>{{ item.timeFormat }}</span></div>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"chat-footer\">\n                    <div class=\"messenger-textarea-wrap\">\n                        <div class=\"messenger-textarea\">\n                            <editable ref=\"textArea\" :content=\"text\" @update=\"text = $event\" class=\"messenger-textarea-input\" @keyup-enter=\"addMessage()\" ></editable>\n                            <span class=\"messenger-placeholder\">Оставьте комментарий...</span>\n                        </div>\n                        <label for=\"chat-file\" class=\"send-photo\">\n                            <img src=\"/local/templates/mossman2018/img/ico-photo-chat.svg\" alt=\"\">\n                        </label>\n                        <input @change=\"preparedFiles = $event.target.files\" id=\"chat-file\" multiple type=\"file\" style=\"display: none;\" />\n                    </div>\n                    <div @click.prevent=\"addMessage()\" class=\"send-message\">\n                        <img src=\"/local/templates/mossman2018/img/ico-send-chat.svg\" alt=\"\">\n                    </div>\n                    <div v-if=\"preparedFiles.length\" class=\"messenger-prepared-files\" >\n                        <div v-for=\"file in preparedFiles\" :key=\"file.lastModified\" class=\"messenger-prepared-files\" >\n                            {{ file.name }}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\n\nimport moment from 'moment';\nmoment.locale('ru');\nwindow.moment = moment;\n\nexport default {\n    name : 'Chat',\n    props : {\n        claimId : {\n            type : Number,\n            default : 0,\n        },\n        orderId : {\n            type : Number,\n            default : 0,\n        },\n        userData : {\n            type : Object,\n            default : () => ({}),\n        },\n    },\n    data : () => ({\n        preparedFiles : [],\n        items : [],\n        text : '',\n    }),\n    computed : {\n        itemsByDate () {\n            let itemsByDate = {}, item, m, date;\n            for (var i = 0; i < this.items.length; i++) {\n                item = this.items[i];\n                m = moment.unix(item.timestamp);\n                date = m.format('DD MMMM YYYY');\n                if (!itemsByDate[date]) {\n                    itemsByDate[date] = [];\n                }\n                item.timeFormat = m.format('HH:mm');\n                itemsByDate[date].push(item);\n            }\n            return itemsByDate;\n        },\n    },\n    mounted () {\n        setInterval(()=>{\n            this.loadData();\n        },5000);\n\n        $('.lc-cont').each(function(){\n            var sticky =  $('.chat-open-btn');\n            var stickyWrap = $('.lc-cont')\n\n            $(window).scroll(function(){\n                var nsc = $(document).scrollTop();\n                var bp1 = stickyWrap.offset().top;\n                var bp2 = bp1 + stickyWrap.outerHeight()-$(window).height();\n                if (nsc>bp1) {\n                    sticky.css('position','fixed');\n                    sticky.addClass('fixed');\n                }\n                else {\n                    sticky.css('position','absolute');\n                    sticky.css('top', '0 !important');\n                    sticky.removeClass('fixed');\n                }\n                if (nsc>bp2) {\n                    sticky.css('top', bp2-nsc);\n                }\n                else {\n                    sticky.css('top', '245px');\n                }\n            });\n        });\n\n        $('.chat-open-btn').on('click', function(){\n            $('.chat').toggleClass('active');\n        });\n\n        $('.chat-close').on('click', function(){\n            $('.chat').removeClass('active');\n        });\n\n        $('.chat-toggle').on('click', function(){\n            $('.chat-body').slideToggle();\n        });\n\n        $(window).scroll(function(){\n            let heightToBottomEdge = $(window).scrollTop() + window.innerHeight;\n            let canSeeFooter = heightToBottomEdge > $('.footer').offset().top;\n            if(canSeeFooter && !window.absoluted)\n            {\n                $('.chat').toggleClass('absolute');\n                $('.chat').toggleClass('fixed');\n                window.absoluted=true;\n            }\n\n            if(!canSeeFooter && window.absoluted)\n            {\n                $('.chat').toggleClass('absolute');\n                $('.chat').toggleClass('fixed');\n                window.absoluted=false;\n            }\n\n        });\n    },\n    watch : {\n\t\titems (messages, oldMessages) {\n\t\t\tif (messages.length != oldMessages.length) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.$el.querySelector('.chat-content').scrollTop = this.$el.querySelector('.chat-content').scrollHeight - this.$el.querySelector('.chat-content').clientHeight;\n\t\t\t\t}, 300);\n\t\t\t}\n\t\t},\n    },\n    methods : {\n        loadData () {\n            BX.ajax.runComponentAction('xpage:ajax', 'chatLoadData', {\n                mode : 'class',\n                data : {\n                    claimId : this.claimId,\n                    orderId : this.orderId,\n                },\n            }).then(response => {\n                if (response.data) {\n                    if (response.data.items && response.data.items.length) {\n                        let unreadMsgIds = [];\n                        let items = response.data.items;\n                        for (var i = 0; i < items.length; i++) {\n                            if (items[i].UF_READ_USER_ID) {\n                                items[i].UF_READ_USER_ID = items[i].UF_READ_USER_ID.map(v=>+v);\n                            }\n                            if (!items[i].UF_READ_USER_ID || !~items[i].UF_READ_USER_ID.indexOf(+this.userData.ID)) {\n                                unreadMsgIds.push(items[i].ID);\n                            }\n                        }\n                        this.items = items;\n                        if (unreadMsgIds.length && document.querySelector('.chat-body').offsetParent) {\n                            this.setMessagesRead(unreadMsgIds);\n                        }\n                    }\n                }\n            });\n        },\n        setMessagesRead (id = []) {\n            if (id.length) {\n                BX.ajax.runComponentAction('xpage:ajax', 'chatSetMessagesRead', {\n                    mode : 'class',\n                    data : {\n                        id,\n                    },\n                }).then(response => {\n\n                });\n            }\n        },\n        addMessage () {\n            let fileInput = this.$el.querySelector('#chat-file');\n            let data = new FormData;\n            data.append('orderId', this.orderId);\n            data.append('claimId', this.claimId);\n            data.append('text', this.text);\n            if (fileInput.files && fileInput.files.length) {\n                for (var i = 0; i < fileInput.files.length; i++) {\n                    data.append('file[]', fileInput.files[i]);\n                }\n            }\n            BX.ajax.runComponentAction('xpage:ajax', 'chatAddMessage', {\n                mode : 'class',\n                data,\n            }).then(response => {\n                this.text = '';\n                this.loadData();\n                this.$refs.textArea.clear();\n                this.preparedFiles = [];\n                fileInput.value = '';\n            });\n        },\n    },\n}\n</script>\n"],"sourceRoot":"src/components"}]}