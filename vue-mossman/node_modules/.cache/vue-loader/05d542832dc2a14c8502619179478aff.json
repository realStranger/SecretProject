{"remainingRequest":"/var/www/html/local/vue-mossman/node_modules/vue-loader/lib/index.js??vue-loader-options!/var/www/html/local/vue-mossman/src/components/Documents.vue?vue&type=script&lang=js&","dependencies":[{"path":"/var/www/html/local/vue-mossman/src/components/Documents.vue","mtime":1604916304000},{"path":"/var/www/html/local/vue-mossman/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/var/www/html/local/vue-mossman/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/var/www/html/local/vue-mossman/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/var/www/html/local/vue-mossman/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCgppbXBvcnQgcGFnZXJNaXhpbiBmcm9tICcuLi9taXhpbnMvUGFnZXIudnVlJzsKCmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWUgOiAnRG9jdW1lbnRzJywKICAgIG1vdW50ZWQgKCkgewogICAgICAgIHRoaXMubG9hZERhdGEoKTsKICAgIH0sCiAgICBtaXhpbnMgOiBbCiAgICAgICAgcGFnZXJNaXhpbiwKICAgIF0sCiAgICBkYXRhIDogKCkgPT4gKHsKICAgICAgICBzZWFyY2ggOiAnJywKICAgICAgICBzZWN0aW9uSWQgOiAwLAogICAgICAgIHBhcmVudFNlY3Rpb25JZCA6IDAsCiAgICAgICAgcmVuYW1lSXRlbUlkIDogMCwKICAgICAgICBpdGVtcyA6IFtdLAogICAgfSksCiAgICB3YXRjaCA6IHsKICAgICAgICBzZWN0aW9uSWQgKHZhbCwgb2xkVmFsKSB7CiAgICAgICAgICAgIHRoaXMubG9hZERhdGEoKTsKICAgICAgICB9LAogICAgICAgIHBhZ2VOdW0gKHZhbCwgb2xkVmFsKSB7CiAgICAgICAgICAgIHRoaXMubG9hZERhdGEoKTsKICAgICAgICB9LAogICAgICAgIHJlbmFtZUl0ZW1JZCAodmFsLCBvbGRWYWwpIHsKICAgICAgICAgICAgaWYgKCt2YWwpIHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCk9PnsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5xdWVyeVNlbGVjdG9yKGAubGMtZG9jX190aXRsZS0tJHt2YWx9IGlucHV0W3R5cGU9InRleHQiXWApLmZvY3VzKCk7CiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy4kZWwucXVlcnlTZWxlY3RvcihgLmxjLWRvY19fdGl0bGUtLSR7dmFsfSBpbnB1dFt0eXBlPSJ0ZXh0Il1gKS5zZWxlY3QoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5xdWVyeVNlbGVjdG9yKGAubGMtZG9jX190aXRsZS0tJHt2YWx9IGlucHV0W3R5cGU9InRleHQiXWApLnNldFNlbGVjdGlvblJhbmdlKAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5xdWVyeVNlbGVjdG9yKGAubGMtZG9jX190aXRsZS0tJHt2YWx9IGlucHV0W3R5cGU9InRleHQiXWApLnZhbHVlLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwucXVlcnlTZWxlY3RvcihgLmxjLWRvY19fdGl0bGUtLSR7dmFsfSBpbnB1dFt0eXBlPSJ0ZXh0Il1gKS52YWx1ZS5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgICdmb3J3YXJkJwogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9LCAzMDApOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgIH0sCiAgICBtZXRob2RzIDogewogICAgICAgIGFwcGx5U2VhcmNoICgpIHsKICAgICAgICAgICAgdGhpcy5sb2FkRGF0YSh0aGlzLnNlYXJjaCk7CiAgICAgICAgfSwKICAgICAgICBsb2FkRGF0YSAoc2VhcmNoID0gJycpIHsKICAgICAgICAgICAgaWYgKCFzZWFyY2gpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2VhcmNoID0gJyc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQlguYWpheC5ydW5Db21wb25lbnRBY3Rpb24oJ3hwYWdlOmFqYXgnLCAnZG9jdW1lbnRzR2V0TGlzdCcsIHsKICAgICAgICAgICAgICAgIG1vZGUgOiAnY2xhc3MnLAogICAgICAgICAgICAgICAgZGF0YSA6IHsKICAgICAgICAgICAgICAgICAgICBzZWN0aW9uSWQgOiB0aGlzLnNlY3Rpb25JZCwKICAgICAgICAgICAgICAgICAgICBwYWdlTnVtIDogdGhpcy5wYWdlTnVtLAogICAgICAgICAgICAgICAgICAgIHNlYXJjaCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICAgICAgdGhpcy5pdGVtcyA9IHJlc3BvbnNlLmRhdGEuaXRlbXMgfHwgW107CiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudFNlY3Rpb25JZCA9IHJlc3BvbnNlLmRhdGEucGFyZW50U2VjdGlvbklkIHx8IDA7CiAgICAgICAgICAgICAgICB0aGlzLnBhZ2VzQ250ID0gK3Jlc3BvbnNlLmRhdGEucGFnZXNDbnQgfHwgMDsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICB1cCAoKSB7CiAgICAgICAgICAgIHRoaXMuc2VjdGlvbklkID0gdGhpcy5wYXJlbnRTZWN0aW9uSWQ7CiAgICAgICAgfSwKICAgICAgICBvcGVuIChpdGVtKSB7CiAgICAgICAgICAgICQodGhpcy4kZWwpLmZpbmQoJy5kcm9wZG93bicpLnNsaWRlVXAoKTsKICAgICAgICAgICAgaWYgKGl0ZW0uZmlsZVNyYykgewogICAgICAgICAgICAgICAgdGhpcy4kcmVmcy5saW5rLmhyZWYgPSBpdGVtLmZpbGVTcmM7CiAgICAgICAgICAgICAgICB0aGlzLiRyZWZzLmxpbmsuY2xpY2soKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc2VjdGlvbklkID0gaXRlbS5JRDsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgcmVuYW1lIChpdGVtKSB7CiAgICAgICAgICAgIHRoaXMucmVuYW1lSXRlbUlkID0gaXRlbS5JRDsKICAgICAgICAgICAgJCh0aGlzLiRlbCkuZmluZCgnLmRyb3Bkb3duJykuc2xpZGVVcCgpOwogICAgICAgIH0sCiAgICAgICAgcmVtb3ZlIChpdGVtKSB7CiAgICAgICAgICAgICQodGhpcy4kZWwpLmZpbmQoJy5kcm9wZG93bicpLnNsaWRlVXAoKTsKICAgICAgICAgICAgQlguYWpheC5ydW5Db21wb25lbnRBY3Rpb24oJ3hwYWdlOmFqYXgnLCAnZG9jdW1lbnRSZW1vdmUnLCB7CiAgICAgICAgICAgICAgICBtb2RlIDogJ2NsYXNzJywKICAgICAgICAgICAgICAgIGRhdGEgOiB7CiAgICAgICAgICAgICAgICAgICAgaWQgOiBpdGVtLklELAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWREYXRhKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYWRkRGlyZWN0b3J5IChpdGVtKSB7CiAgICAgICAgICAgICQodGhpcy4kZWwpLmZpbmQoJy5kcm9wZG93bicpLnNsaWRlVXAoKTsKICAgICAgICAgICAgQlguYWpheC5ydW5Db21wb25lbnRBY3Rpb24oJ3hwYWdlOmFqYXgnLCAnYWRkRGlyZWN0b3J5JywgewogICAgICAgICAgICAgICAgbW9kZSA6ICdjbGFzcycsCiAgICAgICAgICAgICAgICBkYXRhIDogewogICAgICAgICAgICAgICAgICAgIHBhcmVudFNlY3Rpb25JZCA6IHRoaXMuc2VjdGlvbklkLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWREYXRhKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgYWRkRmlsZXMgKCkgewogICAgICAgICAgICB0aGlzLiRyZWZzLmlucHV0RmlsZS5jbGljaygpOwogICAgICAgICAgICAkKHRoaXMuJGVsKS5maW5kKCcuZHJvcGRvd24nKS5zbGlkZVVwKCk7CiAgICAgICAgfSwKICAgICAgICBmaWxlQ2hhbmdlZCAoZSkgewogICAgICAgICAgICBsZXQgZmlsZXMgPSBbXTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZS50YXJnZXQuZmlsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBmaWxlcy5wdXNoKGUudGFyZ2V0LmZpbGVzW2ldKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGZpbGVzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgdGhpcy51cGxvYWRGaWxlcyhmaWxlcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHVwbG9hZEZpbGVzIChmaWxlcyA9IFtdKSB7CiAgICAgICAgICAgIGxldCBkYXRhID0gbmV3IEZvcm1EYXRhOwogICAgICAgICAgICBkYXRhLmFwcGVuZCgnc2VjdGlvbklkJywgdGhpcy5zZWN0aW9uSWQpOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBkYXRhLmFwcGVuZCgnZmlsZVtdJywgZmlsZXNbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIEJYLmFqYXgucnVuQ29tcG9uZW50QWN0aW9uKCd4cGFnZTphamF4JywgJ2FkZEZpbGVzJywgewogICAgICAgICAgICAgICAgbW9kZSA6ICdjbGFzcycsCiAgICAgICAgICAgICAgICBkYXRhLAogICAgICAgICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuJHJlZnMuaW5wdXRGaWxlLnZhbHVlID0gJyc7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWREYXRhKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgc2F2ZSAoaXRlbSwgZmllbGQgPSAnJykgewogICAgICAgICAgICBsZXQgdmFsdWVzOwogICAgICAgICAgICBpZiAoZmllbGQpIHsKICAgICAgICAgICAgICAgIGlmIChpdGVtW2ZpZWxkXSkgewogICAgICAgICAgICAgICAgICAgIHZhbHVlcyA9IHt9OwogICAgICAgICAgICAgICAgICAgIHZhbHVlc1tmaWVsZF0gPSBpdGVtW2ZpZWxkXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHZhbHVlcyA9IGl0ZW07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQlguYWpheC5ydW5Db21wb25lbnRBY3Rpb24oJ3hwYWdlOmFqYXgnLCAnZG9jdW1lbnRTYXZlJywgewogICAgICAgICAgICAgICAgbW9kZSA6ICdjbGFzcycsCiAgICAgICAgICAgICAgICBkYXRhIDogewogICAgICAgICAgICAgICAgICAgIGlkIDogaXRlbS5JRCwKICAgICAgICAgICAgICAgICAgICB2YWx1ZXMsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMucmVuYW1lSXRlbUlkID0gJyc7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWREYXRhKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICB9LAp9Cg=="},{"version":3,"sources":["Documents.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyDA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Documents.vue","sourceRoot":"src/components","sourcesContent":["<template>\n<div class=\"lc-body\">\n    <input style=\"display: none;\" ref=\"inputFile\" @change=\"fileChanged($event)\" type=\"file\" name=\"file\" multiple />\n    <a style=\"display: none;\" ref=\"link\" target=\"_blank\" href=\"#\"></a>\n    <div class=\"lc__top\">\n        <div class=\"lc-search-cont\">\n            <form @submit.prevent=\"applySearch()\" action=\"\">\n                <div class=\"lc-search\">\n                    <input v-model=\"search\" type=\"text\" placeholder=\"Поиск\"/>\n                    <input type=\"submit\" value=\"Найти\"/>\n                </div>\n            </form>\n        </div>\n        <div class=\"select\">\n            <div class=\"label\">Добавить</div>\n            <div class=\"dropdown\">\n                <ul>\n                    <li><a @click.prevent=\"addDirectory()\" href=\"#\"><span class=\"icon\"><img src=\"/local/templates/mossman2018/img/ico-doc-1.svg\" alt=\"\"></span>Создать папку</a></li>\n                    <li><a @click.prevent=\"addFiles()\" href=\"#\"><span class=\"icon\"><img src=\"/local/templates/mossman2018/img/ico-doc-2.svg\" alt=\"\"></span>Загрузить файлы</a></li>\n                </ul>\n            </div>\n        </div>\n    </div>\n    <div class=\"lc-doc\">\n        <div class=\"lc-doc__list\">\n            <div v-if=\"+sectionId\" class=\"lc-doc__item\">\n                <a @click.prevent=\"up()\" href=\"#\">..</a>\n            </div>\n            <div v-for=\"item in items\" :key=\"item.ID\" class=\"lc-doc__item\">\n                <div  class=\"lc-doc__menu\">\n                    <div class=\"toggle-dropdown\"></div>\n                    <div class=\"dropdown\">\n                        <ul>\n                            <li><a href=\"#\" @click.prevent=\"open(item)\" >Открыть</a></li>\n                            <li><a href=\"#\" @click.prevent=\"rename(item)\" >Переименовать</a></li>\n                            <li><a href=\"#\" @click.prevent=\"remove(item)\" >Удалить</a></li>\n                            <!-- <li><a href=\"#\">Копировать</a></li>\n                            <li><a href=\"#\">Переместить</a></li> -->\n                        </ul>\n                    </div>\n                </div>\n                <template v-if=\"!+item.UF_FILE\" >\n                    <div class=\"lc-doc__ico\" style=\"background-image: url('/local/templates/mossman2018/img/ico-folder.svg')\"></div>\n                </template>\n                <div class=\"lc-doc__title\" :class=\"[ `lc-doc__title--${item.ID}`, ]\" >\n                    <input v-model=\"item.UF_NAME\" type=\"text\" :readonly=\"renameItemId != item.ID\" @blur=\"renameItemId ? save(item, 'UF_NAME') : false\" @keyup.enter=\"save(item, 'UF_NAME');\" @dblclick=\"open(item)\" />\n                </div>\n                <div class=\"lc-doc__date\">{{ item.UF_DATETIME }}</div>\n            </div>\n        </div>\n        <pagination v-if=\"pagesCnt > 1\" v-model=\"pageNum\" :pages-cnt=\"pagesCnt\" ></pagination>\n    </div>\n</div>\n</template>\n\n<script>\n\nimport pagerMixin from '../mixins/Pager.vue';\n\nexport default {\n    name : 'Documents',\n    mounted () {\n        this.loadData();\n    },\n    mixins : [\n        pagerMixin,\n    ],\n    data : () => ({\n        search : '',\n        sectionId : 0,\n        parentSectionId : 0,\n        renameItemId : 0,\n        items : [],\n    }),\n    watch : {\n        sectionId (val, oldVal) {\n            this.loadData();\n        },\n        pageNum (val, oldVal) {\n            this.loadData();\n        },\n        renameItemId (val, oldVal) {\n            if (+val) {\n                setTimeout(()=>{\n                    this.$el.querySelector(`.lc-doc__title--${val} input[type=\"text\"]`).focus();\n                    // this.$el.querySelector(`.lc-doc__title--${val} input[type=\"text\"]`).select();\n                    this.$el.querySelector(`.lc-doc__title--${val} input[type=\"text\"]`).setSelectionRange(\n                        this.$el.querySelector(`.lc-doc__title--${val} input[type=\"text\"]`).value.length,\n                        this.$el.querySelector(`.lc-doc__title--${val} input[type=\"text\"]`).value.length,\n                        'forward'\n                    );\n                }, 300);\n            }\n        },\n    },\n    methods : {\n        applySearch () {\n            this.loadData(this.search);\n        },\n        loadData (search = '') {\n            if (!search) {\n                this.search = '';\n            }\n            BX.ajax.runComponentAction('xpage:ajax', 'documentsGetList', {\n                mode : 'class',\n                data : {\n                    sectionId : this.sectionId,\n                    pageNum : this.pageNum,\n                    search,\n                },\n            }).then(response => {\n                this.items = response.data.items || [];\n                this.parentSectionId = response.data.parentSectionId || 0;\n                this.pagesCnt = +response.data.pagesCnt || 0;\n            });\n        },\n        up () {\n            this.sectionId = this.parentSectionId;\n        },\n        open (item) {\n            $(this.$el).find('.dropdown').slideUp();\n            if (item.fileSrc) {\n                this.$refs.link.href = item.fileSrc;\n                this.$refs.link.click();\n            }\n            else {\n                this.sectionId = item.ID;\n            }\n        },\n        rename (item) {\n            this.renameItemId = item.ID;\n            $(this.$el).find('.dropdown').slideUp();\n        },\n        remove (item) {\n            $(this.$el).find('.dropdown').slideUp();\n            BX.ajax.runComponentAction('xpage:ajax', 'documentRemove', {\n                mode : 'class',\n                data : {\n                    id : item.ID,\n                },\n            }).then(response => {\n                this.loadData();\n            });\n        },\n        addDirectory (item) {\n            $(this.$el).find('.dropdown').slideUp();\n            BX.ajax.runComponentAction('xpage:ajax', 'addDirectory', {\n                mode : 'class',\n                data : {\n                    parentSectionId : this.sectionId,\n                },\n            }).then(response => {\n                this.loadData();\n            });\n        },\n        addFiles () {\n            this.$refs.inputFile.click();\n            $(this.$el).find('.dropdown').slideUp();\n        },\n        fileChanged (e) {\n            let files = [];\n            try {\n                for (var i = 0; i < e.target.files.length; i++) {\n                    files.push(e.target.files[i]);\n                }\n            } catch (e) {\n                console.log(e);\n            }\n            if (files.length) {\n                this.uploadFiles(files);\n            }\n        },\n        uploadFiles (files = []) {\n            let data = new FormData;\n            data.append('sectionId', this.sectionId);\n            for (var i = 0; i < files.length; i++) {\n                data.append('file[]', files[i]);\n            }\n            BX.ajax.runComponentAction('xpage:ajax', 'addFiles', {\n                mode : 'class',\n                data,\n            }).then(response => {\n                this.$refs.inputFile.value = '';\n                this.loadData();\n            });\n        },\n        save (item, field = '') {\n            let values;\n            if (field) {\n                if (item[field]) {\n                    values = {};\n                    values[field] = item[field];\n                }\n            }\n            else {\n                values = item;\n            }\n            BX.ajax.runComponentAction('xpage:ajax', 'documentSave', {\n                mode : 'class',\n                data : {\n                    id : item.ID,\n                    values,\n                },\n            }).then(response => {\n                this.renameItemId = '';\n                this.loadData();\n            });\n        },\n    },\n}\n</script>\n"]}]}