{"remainingRequest":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/src/components/Chat.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/src/components/Chat.vue","mtime":1596108899440},{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCgppbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7Cm1vbWVudC5sb2NhbGUoJ3J1Jyk7CndpbmRvdy5tb21lbnQgPSBtb21lbnQ7CgpleHBvcnQgZGVmYXVsdCB7CiAgICBuYW1lIDogJ0NoYXQnLAogICAgcHJvcHMgOiB7CiAgICAgICAgY2xhaW1JZCA6IHsKICAgICAgICAgICAgdHlwZSA6IE51bWJlciwKICAgICAgICAgICAgZGVmYXVsdCA6IDAsCiAgICAgICAgfSwKICAgICAgICBvcmRlcklkIDogewogICAgICAgICAgICB0eXBlIDogTnVtYmVyLAogICAgICAgICAgICBkZWZhdWx0IDogMCwKICAgICAgICB9LAogICAgICAgIHVzZXJEYXRhIDogewogICAgICAgICAgICB0eXBlIDogT2JqZWN0LAogICAgICAgICAgICBkZWZhdWx0IDogKCkgPT4gKHt9KSwKICAgICAgICB9LAogICAgfSwKICAgIGRhdGEgOiAoKSA9PiAoewogICAgICAgIHByZXBhcmVkRmlsZXMgOiBbXSwKICAgICAgICBpdGVtcyA6IFtdLAogICAgICAgIHRleHQgOiAnJywKICAgIH0pLAogICAgY29tcHV0ZWQgOiB7CiAgICAgICAgaXRlbXNCeURhdGUgKCkgewogICAgICAgICAgICBsZXQgaXRlbXNCeURhdGUgPSB7fSwgaXRlbSwgbSwgZGF0ZTsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLml0ZW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpdGVtID0gdGhpcy5pdGVtc1tpXTsKICAgICAgICAgICAgICAgIG0gPSBtb21lbnQudW5peChpdGVtLnRpbWVzdGFtcCk7CiAgICAgICAgICAgICAgICBkYXRlID0gbS5mb3JtYXQoJ0REIE1NTU0gWVlZWScpOwogICAgICAgICAgICAgICAgaWYgKCFpdGVtc0J5RGF0ZVtkYXRlXSkgewogICAgICAgICAgICAgICAgICAgIGl0ZW1zQnlEYXRlW2RhdGVdID0gW107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpdGVtLnRpbWVGb3JtYXQgPSBtLmZvcm1hdCgnSEg6bW0nKTsKICAgICAgICAgICAgICAgIGl0ZW1zQnlEYXRlW2RhdGVdLnB1c2goaXRlbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGl0ZW1zQnlEYXRlOwogICAgICAgIH0sCiAgICB9LAogICAgbW91bnRlZCAoKSB7CiAgICAgICAgc2V0SW50ZXJ2YWwoKCk9PnsKICAgICAgICAgICAgdGhpcy5sb2FkRGF0YSgpOwogICAgICAgIH0sNTAwMCk7CgogICAgICAgICQoJy5sYy1jb250JykuZWFjaChmdW5jdGlvbigpewogICAgICAgICAgICB2YXIgc3RpY2t5ID0gICQoJy5jaGF0LW9wZW4tYnRuJyk7CiAgICAgICAgICAgIHZhciBzdGlja3lXcmFwID0gJCgnLmxjLWNvbnQnKQoKICAgICAgICAgICAgJCh3aW5kb3cpLnNjcm9sbChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIG5zYyA9ICQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpOwogICAgICAgICAgICAgICAgdmFyIGJwMSA9IHN0aWNreVdyYXAub2Zmc2V0KCkudG9wOwogICAgICAgICAgICAgICAgdmFyIGJwMiA9IGJwMSArIHN0aWNreVdyYXAub3V0ZXJIZWlnaHQoKS0kKHdpbmRvdykuaGVpZ2h0KCk7CiAgICAgICAgICAgICAgICBpZiAobnNjPmJwMSkgewogICAgICAgICAgICAgICAgICAgIHN0aWNreS5jc3MoJ3Bvc2l0aW9uJywnZml4ZWQnKTsKICAgICAgICAgICAgICAgICAgICBzdGlja3kuYWRkQ2xhc3MoJ2ZpeGVkJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzdGlja3kuY3NzKCdwb3NpdGlvbicsJ2Fic29sdXRlJyk7CiAgICAgICAgICAgICAgICAgICAgc3RpY2t5LmNzcygndG9wJywgJzAgIWltcG9ydGFudCcpOwogICAgICAgICAgICAgICAgICAgIHN0aWNreS5yZW1vdmVDbGFzcygnZml4ZWQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChuc2M+YnAyKSB7CiAgICAgICAgICAgICAgICAgICAgc3RpY2t5LmNzcygndG9wJywgYnAyLW5zYyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzdGlja3kuY3NzKCd0b3AnLCAnMjQ1cHgnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgICQoJy5jaGF0LW9wZW4tYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXsKICAgICAgICAgICAgJCgnLmNoYXQnKS50b2dnbGVDbGFzcygnYWN0aXZlJyk7CiAgICAgICAgfSk7CgogICAgICAgICQoJy5jaGF0LWNsb3NlJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXsKICAgICAgICAgICAgJCgnLmNoYXQnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7CiAgICAgICAgfSk7CgogICAgICAgICQoJy5jaGF0LXRvZ2dsZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICQoJy5jaGF0LWJvZHknKS5zbGlkZVRvZ2dsZSgpOwogICAgICAgIH0pOwoKICAgICAgICAkKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIGxldCBoZWlnaHRUb0JvdHRvbUVkZ2UgPSAkKHdpbmRvdykuc2Nyb2xsVG9wKCkgKyB3aW5kb3cuaW5uZXJIZWlnaHQ7CiAgICAgICAgICAgIGxldCBjYW5TZWVGb290ZXIgPSBoZWlnaHRUb0JvdHRvbUVkZ2UgPiAkKCcuZm9vdGVyJykub2Zmc2V0KCkudG9wOwogICAgICAgICAgICBpZihjYW5TZWVGb290ZXIgJiYgIXdpbmRvdy5hYnNvbHV0ZWQpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICQoJy5jaGF0JykudG9nZ2xlQ2xhc3MoJ2Fic29sdXRlJyk7CiAgICAgICAgICAgICAgICAkKCcuY2hhdCcpLnRvZ2dsZUNsYXNzKCdmaXhlZCcpOwogICAgICAgICAgICAgICAgd2luZG93LmFic29sdXRlZD10cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZighY2FuU2VlRm9vdGVyICYmIHdpbmRvdy5hYnNvbHV0ZWQpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICQoJy5jaGF0JykudG9nZ2xlQ2xhc3MoJ2Fic29sdXRlJyk7CiAgICAgICAgICAgICAgICAkKCcuY2hhdCcpLnRvZ2dsZUNsYXNzKCdmaXhlZCcpOwogICAgICAgICAgICAgICAgd2luZG93LmFic29sdXRlZD1mYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICB9KTsKICAgIH0sCiAgICB3YXRjaCA6IHsKCQlpdGVtcyAobWVzc2FnZXMsIG9sZE1lc3NhZ2VzKSB7CgkJCWlmIChtZXNzYWdlcy5sZW5ndGggIT0gb2xkTWVzc2FnZXMubGVuZ3RoKSB7CgkJCQlzZXRUaW1lb3V0KCgpID0+IHsKCQkJCQl0aGlzLiRlbC5xdWVyeVNlbGVjdG9yKCcuY2hhdC1jb250ZW50Jykuc2Nyb2xsVG9wID0gdGhpcy4kZWwucXVlcnlTZWxlY3RvcignLmNoYXQtY29udGVudCcpLnNjcm9sbEhlaWdodCAtIHRoaXMuJGVsLnF1ZXJ5U2VsZWN0b3IoJy5jaGF0LWNvbnRlbnQnKS5jbGllbnRIZWlnaHQ7CgkJCQl9LCAzMDApOwoJCQl9CgkJfSwKICAgIH0sCiAgICBtZXRob2RzIDogewogICAgICAgIGxvYWREYXRhICgpIHsKICAgICAgICAgICAgQlguYWpheC5ydW5Db21wb25lbnRBY3Rpb24oJ3hwYWdlOmFqYXgnLCAnY2hhdExvYWREYXRhJywgewogICAgICAgICAgICAgICAgbW9kZSA6ICdjbGFzcycsCiAgICAgICAgICAgICAgICBkYXRhIDogewogICAgICAgICAgICAgICAgICAgIGNsYWltSWQgOiB0aGlzLmNsYWltSWQsCiAgICAgICAgICAgICAgICAgICAgb3JkZXJJZCA6IHRoaXMub3JkZXJJZCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5pdGVtcyAmJiByZXNwb25zZS5kYXRhLml0ZW1zLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgdW5yZWFkTXNnSWRzID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpdGVtcyA9IHJlc3BvbnNlLmRhdGEuaXRlbXM7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtc1tpXS5VRl9SRUFEX1VTRVJfSUQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1tpXS5VRl9SRUFEX1VTRVJfSUQgPSBpdGVtc1tpXS5VRl9SRUFEX1VTRVJfSUQubWFwKHY9Pit2KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXRlbXNbaV0uVUZfUkVBRF9VU0VSX0lEIHx8ICF+aXRlbXNbaV0uVUZfUkVBRF9VU0VSX0lELmluZGV4T2YoK3RoaXMudXNlckRhdGEuSUQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5yZWFkTXNnSWRzLnB1c2goaXRlbXNbaV0uSUQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBpdGVtczsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVucmVhZE1zZ0lkcy5sZW5ndGggJiYgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoYXQtYm9keScpLm9mZnNldFBhcmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRNZXNzYWdlc1JlYWQodW5yZWFkTXNnSWRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBzZXRNZXNzYWdlc1JlYWQgKGlkID0gW10pIHsKICAgICAgICAgICAgaWYgKGlkLmxlbmd0aCkgewogICAgICAgICAgICAgICAgQlguYWpheC5ydW5Db21wb25lbnRBY3Rpb24oJ3hwYWdlOmFqYXgnLCAnY2hhdFNldE1lc3NhZ2VzUmVhZCcsIHsKICAgICAgICAgICAgICAgICAgICBtb2RlIDogJ2NsYXNzJywKICAgICAgICAgICAgICAgICAgICBkYXRhIDogewogICAgICAgICAgICAgICAgICAgICAgICBpZCwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiB7CgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFkZE1lc3NhZ2UgKCkgewogICAgICAgICAgICBsZXQgZmlsZUlucHV0ID0gdGhpcy4kZWwucXVlcnlTZWxlY3RvcignI2NoYXQtZmlsZScpOwogICAgICAgICAgICBsZXQgZGF0YSA9IG5ldyBGb3JtRGF0YTsKICAgICAgICAgICAgZGF0YS5hcHBlbmQoJ29yZGVySWQnLCB0aGlzLm9yZGVySWQpOwogICAgICAgICAgICBkYXRhLmFwcGVuZCgnY2xhaW1JZCcsIHRoaXMuY2xhaW1JZCk7CiAgICAgICAgICAgIGRhdGEuYXBwZW5kKCd0ZXh0JywgdGhpcy50ZXh0KTsKICAgICAgICAgICAgaWYgKGZpbGVJbnB1dC5maWxlcyAmJiBmaWxlSW5wdXQuZmlsZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZpbGVJbnB1dC5maWxlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGRhdGEuYXBwZW5kKCdmaWxlW10nLCBmaWxlSW5wdXQuZmlsZXNbaV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIEJYLmFqYXgucnVuQ29tcG9uZW50QWN0aW9uKCd4cGFnZTphamF4JywgJ2NoYXRBZGRNZXNzYWdlJywgewogICAgICAgICAgICAgICAgbW9kZSA6ICdjbGFzcycsCiAgICAgICAgICAgICAgICBkYXRhLAogICAgICAgICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMudGV4dCA9ICcnOwogICAgICAgICAgICAgICAgdGhpcy5sb2FkRGF0YSgpOwogICAgICAgICAgICAgICAgdGhpcy4kcmVmcy50ZXh0QXJlYS5jbGVhcigpOwogICAgICAgICAgICAgICAgdGhpcy5wcmVwYXJlZEZpbGVzID0gW107CiAgICAgICAgICAgICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJzsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgIH0sCn0K"},{"version":3,"sources":["Chat.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Chat.vue","sourceRoot":"src/components","sourcesContent":["<template>\n    <div class=\"\">\n        <div class=\"chat-open-btn\">\n            <img src=\"/local/templates/mossman2018/img/ico-chat.svg\" alt=\"\">\n        </div>\n        <div class=\"chat fixed active\">\n            <div class=\"chat-header\">\n                <div class=\"chat-title\">Комментарии</div>\n                <div class=\"chat-btn\">\n                    <div class=\"chat-toggle\"><img src=\"/local/templates/mossman2018/img/ico-toggle-chat.svg\" alt=\"\"></div>\n                    <div class=\"chat-close\"><img src=\"/local/templates/mossman2018/img/ico-close-chat.svg\" alt=\"\"></div>\n                </div>\n            </div>\n            <div class=\"chat-body\">\n                <div class=\"chat-content\">\n                    <div v-for=\"(dateItems, date) in itemsByDate\" :key=\"date\" class=\"chat-items\">\n                        <div class=\"chat-date\"><span>{{ date }}</span></div>\n                        <div v-for=\"item in dateItems\" :key=\"item.ID\"\n                        class=\"chat-item\"\n                        :class=\"{\n                            'message-in' : item.UF_USER_ID != userData.ID && item.UF_USER_CODE != userData.XML_ID,\n                            'message-out' : item.UF_USER_ID == userData.ID || item.UF_USER_CODE == userData.XML_ID,\n                            }\"\n                            >\n                            <div class=\"sender-name color-text\">{{ [ item.USER_LAST_NAME, item.NAME, item.USER_SECOND_NAME, ].filter(v=>v).join(' ') }}</div>\n                            <div class=\"message-text\">\n                                {{ item.UF_TEXT }}\n                                <div v-if=\"item.files && item.files.length\" class=\"message-attach\">\n                                    <div v-for=\"file in item.files\" :key=\"file.id\" class=\"message-attach__item\">\n                                        <a :href=\"file.src\" target=\"_blank\" >{{ file.filename }}</a>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class=\"message-time\"><span>{{ item.timeFormat }}</span></div>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"chat-footer\">\n                    <div class=\"messenger-textarea-wrap\">\n                        <div class=\"messenger-textarea\">\n                            <editable ref=\"textArea\" :content=\"text\" @update=\"text = $event\" class=\"messenger-textarea-input\" @keyup-enter=\"addMessage()\" ></editable>\n                            <span class=\"messenger-placeholder\">Оставьте комментарий...</span>\n                        </div>\n                        <label for=\"chat-file\" class=\"send-photo\">\n                            <img src=\"/local/templates/mossman2018/img/ico-photo-chat.svg\" alt=\"\">\n                        </label>\n                        <input @change=\"preparedFiles = $event.target.files\" id=\"chat-file\" multiple type=\"file\" style=\"display: none;\" />\n                    </div>\n                    <div @click.prevent=\"addMessage()\" class=\"send-message\">\n                        <img src=\"/local/templates/mossman2018/img/ico-send-chat.svg\" alt=\"\">\n                    </div>\n                    <div v-if=\"preparedFiles.length\" class=\"messenger-prepared-files\" >\n                        <div v-for=\"file in preparedFiles\" :key=\"file.lastModified\" class=\"messenger-prepared-files\" >\n                            {{ file.name }}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\n\nimport moment from 'moment';\nmoment.locale('ru');\nwindow.moment = moment;\n\nexport default {\n    name : 'Chat',\n    props : {\n        claimId : {\n            type : Number,\n            default : 0,\n        },\n        orderId : {\n            type : Number,\n            default : 0,\n        },\n        userData : {\n            type : Object,\n            default : () => ({}),\n        },\n    },\n    data : () => ({\n        preparedFiles : [],\n        items : [],\n        text : '',\n    }),\n    computed : {\n        itemsByDate () {\n            let itemsByDate = {}, item, m, date;\n            for (var i = 0; i < this.items.length; i++) {\n                item = this.items[i];\n                m = moment.unix(item.timestamp);\n                date = m.format('DD MMMM YYYY');\n                if (!itemsByDate[date]) {\n                    itemsByDate[date] = [];\n                }\n                item.timeFormat = m.format('HH:mm');\n                itemsByDate[date].push(item);\n            }\n            return itemsByDate;\n        },\n    },\n    mounted () {\n        setInterval(()=>{\n            this.loadData();\n        },5000);\n\n        $('.lc-cont').each(function(){\n            var sticky =  $('.chat-open-btn');\n            var stickyWrap = $('.lc-cont')\n\n            $(window).scroll(function(){\n                var nsc = $(document).scrollTop();\n                var bp1 = stickyWrap.offset().top;\n                var bp2 = bp1 + stickyWrap.outerHeight()-$(window).height();\n                if (nsc>bp1) {\n                    sticky.css('position','fixed');\n                    sticky.addClass('fixed');\n                }\n                else {\n                    sticky.css('position','absolute');\n                    sticky.css('top', '0 !important');\n                    sticky.removeClass('fixed');\n                }\n                if (nsc>bp2) {\n                    sticky.css('top', bp2-nsc);\n                }\n                else {\n                    sticky.css('top', '245px');\n                }\n            });\n        });\n\n        $('.chat-open-btn').on('click', function(){\n            $('.chat').toggleClass('active');\n        });\n\n        $('.chat-close').on('click', function(){\n            $('.chat').removeClass('active');\n        });\n\n        $('.chat-toggle').on('click', function(){\n            $('.chat-body').slideToggle();\n        });\n\n        $(window).scroll(function(){\n            let heightToBottomEdge = $(window).scrollTop() + window.innerHeight;\n            let canSeeFooter = heightToBottomEdge > $('.footer').offset().top;\n            if(canSeeFooter && !window.absoluted)\n            {\n                $('.chat').toggleClass('absolute');\n                $('.chat').toggleClass('fixed');\n                window.absoluted=true;\n            }\n\n            if(!canSeeFooter && window.absoluted)\n            {\n                $('.chat').toggleClass('absolute');\n                $('.chat').toggleClass('fixed');\n                window.absoluted=false;\n            }\n\n        });\n    },\n    watch : {\n\t\titems (messages, oldMessages) {\n\t\t\tif (messages.length != oldMessages.length) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.$el.querySelector('.chat-content').scrollTop = this.$el.querySelector('.chat-content').scrollHeight - this.$el.querySelector('.chat-content').clientHeight;\n\t\t\t\t}, 300);\n\t\t\t}\n\t\t},\n    },\n    methods : {\n        loadData () {\n            BX.ajax.runComponentAction('xpage:ajax', 'chatLoadData', {\n                mode : 'class',\n                data : {\n                    claimId : this.claimId,\n                    orderId : this.orderId,\n                },\n            }).then(response => {\n                if (response.data) {\n                    if (response.data.items && response.data.items.length) {\n                        let unreadMsgIds = [];\n                        let items = response.data.items;\n                        for (var i = 0; i < items.length; i++) {\n                            if (items[i].UF_READ_USER_ID) {\n                                items[i].UF_READ_USER_ID = items[i].UF_READ_USER_ID.map(v=>+v);\n                            }\n                            if (!items[i].UF_READ_USER_ID || !~items[i].UF_READ_USER_ID.indexOf(+this.userData.ID)) {\n                                unreadMsgIds.push(items[i].ID);\n                            }\n                        }\n                        this.items = items;\n                        if (unreadMsgIds.length && document.querySelector('.chat-body').offsetParent) {\n                            this.setMessagesRead(unreadMsgIds);\n                        }\n                    }\n                }\n            });\n        },\n        setMessagesRead (id = []) {\n            if (id.length) {\n                BX.ajax.runComponentAction('xpage:ajax', 'chatSetMessagesRead', {\n                    mode : 'class',\n                    data : {\n                        id,\n                    },\n                }).then(response => {\n\n                });\n            }\n        },\n        addMessage () {\n            let fileInput = this.$el.querySelector('#chat-file');\n            let data = new FormData;\n            data.append('orderId', this.orderId);\n            data.append('claimId', this.claimId);\n            data.append('text', this.text);\n            if (fileInput.files && fileInput.files.length) {\n                for (var i = 0; i < fileInput.files.length; i++) {\n                    data.append('file[]', fileInput.files[i]);\n                }\n            }\n            BX.ajax.runComponentAction('xpage:ajax', 'chatAddMessage', {\n                mode : 'class',\n                data,\n            }).then(response => {\n                this.text = '';\n                this.loadData();\n                this.$refs.textArea.clear();\n                this.preparedFiles = [];\n                fileInput.value = '';\n            });\n        },\n    },\n}\n</script>\n"]}]}