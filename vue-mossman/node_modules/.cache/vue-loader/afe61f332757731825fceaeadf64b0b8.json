{"remainingRequest":"/var/www/html/local/vue-mossman/node_modules/vue-loader/lib/index.js??vue-loader-options!/var/www/html/local/vue-mossman/src/components/Chat.vue?vue&type=script&lang=js&","dependencies":[{"path":"/var/www/html/local/vue-mossman/src/components/Chat.vue","mtime":1604916304000},{"path":"/var/www/html/local/vue-mossman/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/var/www/html/local/vue-mossman/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/var/www/html/local/vue-mossman/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/var/www/html/local/vue-mossman/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCgppbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7Cm1vbWVudC5sb2NhbGUoJ3J1Jyk7CndpbmRvdy5tb21lbnQgPSBtb21lbnQ7CgpleHBvcnQgZGVmYXVsdCB7CiAgICBuYW1lIDogJ0NoYXQnLAogICAgcHJvcHMgOiB7CiAgICAgICAgY2xhaW1JZCA6IHsKICAgICAgICAgICAgdHlwZSA6IE51bWJlciwKICAgICAgICAgICAgZGVmYXVsdCA6IDAsCiAgICAgICAgfSwKICAgICAgICBvcmRlcklkIDogewogICAgICAgICAgICB0eXBlIDogTnVtYmVyLAogICAgICAgICAgICBkZWZhdWx0IDogMCwKICAgICAgICB9LAogICAgICAgIHVzZXJEYXRhIDogewogICAgICAgICAgICB0eXBlIDogT2JqZWN0LAogICAgICAgICAgICBkZWZhdWx0IDogKCkgPT4gKHt9KSwKICAgICAgICB9LAogICAgfSwKICAgIGRhdGEgOiAoKSA9PiAoewogICAgICAgIHByZXBhcmVkRmlsZXMgOiBbXSwKICAgICAgICBpdGVtcyA6IFtdLAogICAgICAgIHN1YmplY3QgOiAnJywKICAgICAgICB1c2VyUmVjaXZlIDogJycsCiAgICAgICAgdGV4dCA6ICcnLAogICAgICAgIHZhbHVlcyA6IHsKICAgICAgICAgICAgVUZfVFlQRSA6ICcnLAogICAgICAgICAgICBVRl9DT05UUkFDVE9SIDogJycsCiAgICAgICAgICAgIFVGX1BSSU1BUllfT1JERVIgOiAnJywKICAgICAgICAgICAgVUZfM0NBRF9TRVJWRVJfTlVNIDogJycsCiAgICAgICAgICAgIFVGXzNDQURfU0VSVkVSX0RBVEUgOiAnJywKICAgICAgICAgICAgVUZfTU9ERUwgOiAnJywKICAgICAgICAgICAgVUZfU0hJUE1FTlRfQUREUkVTUyA6ICcnLAogICAgICAgICAgICBVRl9UUkFOU1BPUlRfQ09NUEFOWSA6ICcnLAogICAgICAgICAgICBVRl9DT01NRU5UIDogJycsCiAgICAgICAgICAgIFVGX0ZBQ1RPUllfVElUTEUgOiAnJywKICAgICAgICAgICAgVUZfU1VNIDogJycsCiAgICAgICAgICAgIFVGX0FDQ0VQVF9NTkdSX0RBVEUgOiAnJywKICAgICAgICAgICAgVUZfUFJPQ0VTX01OR1JfREFURSA6ICcnLAogICAgICAgICAgICBVRl9QUk9DRVNTX1RFQ0hfREFURSA6ICcnLAogICAgICAgICAgICBVRl9JTlZPSUNFX05VTSA6ICcnLAogICAgICAgICAgICBVRl9JTlZPSUNFX0RBVEUgOiAnJywKICAgICAgICAgICAgVUZfSU5WT0lDRV9TVU0gOiAnJywKICAgICAgICAgICAgVUZfSU5WT0lDRV9BQ1BUX0RBVEUgOiAnJywKICAgICAgICAgICAgVUZfQUNDT1VOVElOR19EQVRFIDogJycsCiAgICAgICAgICAgIFVGX1BMQU5fREFURSA6ICcnLAogICAgICAgICAgICBVRl9SRVNQT05TSUJMRV9OQU1FIDogJycsCiAgICAgICAgICAgIFVGX1JFU1BPTlNJQkxFX1BIT05FIDogJycsCiAgICAgICAgICAgIFVGX1NUQVRVUyA6ICcnLAogICAgICAgICAgICBVRl9BQ0NFUFRFRF9NQU5BR0VSIDogJycsCiAgICAgICAgICAgIFVGX1BST0NFU1NFRF9NQU5BR0VSIDogJycsCiAgICAgICAgICAgIFVGX1BST0NFU1NFRF9URUNIIDogJycsCiAgICAgICAgICAgIFVGX0lOVk9JQ0VfTkFNRSA6ICcnLAogICAgICAgICAgICBVRl9JTlZPSUNFX0FDUFRfTkFNRSA6ICcnLAogICAgICAgICAgICBVRl9BQ0NPVU5USU5HX05BTUUgOiAnJywKICAgICAgICAgICAgVUZfQ09OVFJBQ1RPUl9DT0RFIDogJycsCiAgICAgICAgICAgIFVGX0lOTkVSX0NPREUgOiAnJywKICAgICAgICAgICAgVUZfM0NBRF9TRVJWRVJfTlVNX05FVyA6ICcnLAogICAgICAgICAgICBVRl9DQU5DRUxFRCA6IDAsCiAgICAgICAgICAgIFVGX1BBVVNFRCA6IDAsCiAgICAgICAgfSwKICAgICAgICB1c2Vyc0ZpbHRlcmVkIDogJycsCiAgICAgICAgdXNlcnNBbGw6ICcnLAogICAgICAgIG1lc3NhZ2VTZWxlY3QgOiAnJywKICAgICAgICBtZXNzYWdlU2VsZWN0VGV4dCA6ICcnLAogICAgICAgIHVzZXJTZWxlY3QgOiAnJywKICAgICAgICB1bnJlYWRNc2cgOiAnJywKICAgIH0pLAogICAgY29tcHV0ZWQgOiB7CiAgICAgICAgaXRlbXNCeURhdGUgKCkgewogICAgICAgICAgICBsZXQgaXRlbXNCeURhdGUgPSB7fSwgaXRlbSwgbSwgZGF0ZTsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLml0ZW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpdGVtID0gdGhpcy5pdGVtc1tpXTsKICAgICAgICAgICAgICAgIG0gPSBtb21lbnQudW5peChpdGVtLnRpbWVzdGFtcCk7CiAgICAgICAgICAgICAgICBkYXRlID0gbS5mb3JtYXQoJ0REIE1NTU0gWVlZWScpOwogICAgICAgICAgICAgICAgaWYgKCFpdGVtc0J5RGF0ZVtkYXRlXSkgewogICAgICAgICAgICAgICAgICAgIGl0ZW1zQnlEYXRlW2RhdGVdID0gW107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpdGVtLnRpbWVGb3JtYXQgPSBtLmZvcm1hdCgnSEg6bW0nKTsKICAgICAgICAgICAgICAgIGl0ZW1zQnlEYXRlW2RhdGVdLnB1c2goaXRlbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGl0ZW1zQnlEYXRlOwogICAgICAgIH0sCiAgICB9LAogICAgbW91bnRlZCAoKSB7CiAgICAgICAgc2V0SW50ZXJ2YWwoKCk9PnsKICAgICAgICAgICAgdGhpcy5sb2FkRGF0YSgpOwogICAgICAgIH0sNTAwMCk7ICAgICAgICAKCiAgICAgICAgJCgnLmxjLWNvbnQnKS5lYWNoKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHZhciBzdGlja3kgPSAgJCgnLmNoYXQtb3Blbi1idG4nKTsKICAgICAgICAgICAgdmFyIHN0aWNreVdyYXAgPSAkKCcubGMtY29udCcpCgogICAgICAgICAgICAkKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB2YXIgbnNjID0gJChkb2N1bWVudCkuc2Nyb2xsVG9wKCk7CiAgICAgICAgICAgICAgICB2YXIgYnAxID0gc3RpY2t5V3JhcC5vZmZzZXQoKS50b3A7CiAgICAgICAgICAgICAgICB2YXIgYnAyID0gYnAxICsgc3RpY2t5V3JhcC5vdXRlckhlaWdodCgpLSQod2luZG93KS5oZWlnaHQoKTsKICAgICAgICAgICAgICAgIGlmIChuc2M+YnAxKSB7CiAgICAgICAgICAgICAgICAgICAgc3RpY2t5LmNzcygncG9zaXRpb24nLCdmaXhlZCcpOwogICAgICAgICAgICAgICAgICAgIHN0aWNreS5hZGRDbGFzcygnZml4ZWQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHN0aWNreS5jc3MoJ3Bvc2l0aW9uJywnYWJzb2x1dGUnKTsKICAgICAgICAgICAgICAgICAgICBzdGlja3kuY3NzKCd0b3AnLCAnMCAhaW1wb3J0YW50Jyk7CiAgICAgICAgICAgICAgICAgICAgc3RpY2t5LnJlbW92ZUNsYXNzKCdmaXhlZCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG5zYz5icDIpIHsKICAgICAgICAgICAgICAgICAgICBzdGlja3kuY3NzKCd0b3AnLCBicDItbnNjKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHN0aWNreS5jc3MoJ3RvcCcsICcyNDVweCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgJCgnLmNoYXQtb3Blbi1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbigpewogICAgICAgICAgICAkKCcuY2hhdCcpLnRvZ2dsZUNsYXNzKCdhY3RpdmUnKTsKICAgICAgICB9KTsKCiAgICAgICAgJCgnLmNoYXQtY2xvc2UnKS5vbignY2xpY2snLCBmdW5jdGlvbigpewogICAgICAgICAgICAkKCcuY2hhdCcpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsKICAgICAgICB9KTsKCiAgICAgICAgJCgnLmNoYXQtdG9nZ2xlJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXsKICAgICAgICAgICAgJCgnLmNoYXQtYm9keScpLnNsaWRlVG9nZ2xlKCk7CiAgICAgICAgfSk7CgogICAgICAgICQod2luZG93KS5zY3JvbGwoZnVuY3Rpb24oKXsKICAgICAgICAgICAgbGV0IGhlaWdodFRvQm90dG9tRWRnZSA9ICQod2luZG93KS5zY3JvbGxUb3AoKSArIHdpbmRvdy5pbm5lckhlaWdodDsKICAgICAgICAgICAgbGV0IGNhblNlZUZvb3RlciA9IGhlaWdodFRvQm90dG9tRWRnZSA+ICQoJy5mb290ZXInKS5vZmZzZXQoKS50b3A7CiAgICAgICAgICAgIGlmKGNhblNlZUZvb3RlciAmJiAhd2luZG93LmFic29sdXRlZCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJCgnLmNoYXQnKS50b2dnbGVDbGFzcygnYWJzb2x1dGUnKTsKICAgICAgICAgICAgICAgICQoJy5jaGF0JykudG9nZ2xlQ2xhc3MoJ2ZpeGVkJyk7CiAgICAgICAgICAgICAgICB3aW5kb3cuYWJzb2x1dGVkPXRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCFjYW5TZWVGb290ZXIgJiYgd2luZG93LmFic29sdXRlZCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJCgnLmNoYXQnKS50b2dnbGVDbGFzcygnYWJzb2x1dGUnKTsKICAgICAgICAgICAgICAgICQoJy5jaGF0JykudG9nZ2xlQ2xhc3MoJ2ZpeGVkJyk7CiAgICAgICAgICAgICAgICB3aW5kb3cuYWJzb2x1dGVkPWZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgIH0pOwogICAgfSwKICAgIHdhdGNoIDogewoJCWl0ZW1zIChtZXNzYWdlcywgb2xkTWVzc2FnZXMpIHsKCQkJaWYgKG1lc3NhZ2VzLmxlbmd0aCAhPSBvbGRNZXNzYWdlcy5sZW5ndGgpIHsKCQkJCXNldFRpbWVvdXQoKCkgPT4gewoJCQkJCXRoaXMuJGVsLnF1ZXJ5U2VsZWN0b3IoJy5jaGF0LWNvbnRlbnQnKS5zY3JvbGxUb3AgPSB0aGlzLiRlbC5xdWVyeVNlbGVjdG9yKCcuY2hhdC1jb250ZW50Jykuc2Nyb2xsSGVpZ2h0IC0gdGhpcy4kZWwucXVlcnlTZWxlY3RvcignLmNoYXQtY29udGVudCcpLmNsaWVudEhlaWdodDsKCQkJCX0sIDMwMCk7CgkJCX0KCQl9LAogICAgfSwKICAgIG1ldGhvZHMgOiB7CiAgICAgICAgbG9hZERhdGEgKCkgewogICAgICAgICAgICBCWC5hamF4LnJ1bkNvbXBvbmVudEFjdGlvbigneHBhZ2U6YWpheCcsICdjaGF0TG9hZERhdGEnLCB7CiAgICAgICAgICAgICAgICBtb2RlIDogJ2NsYXNzJywKICAgICAgICAgICAgICAgIGRhdGEgOiB7CiAgICAgICAgICAgICAgICAgICAgY2xhaW1JZCA6IHRoaXMuY2xhaW1JZCwKICAgICAgICAgICAgICAgICAgICBvcmRlcklkIDogdGhpcy5vcmRlcklkLAogICAgICAgICAgICAgICAgICAgIHVzZXJYTUwgOiB0aGlzLnVzZXJEYXRhLlhNTF9JRCwKICAgICAgICAgICAgICAgICAgICB1c2VySUQgOiB0aGlzLnVzZXJEYXRhLklECiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuaXRlbXMgJiYgcmVzcG9uc2UuZGF0YS5pdGVtcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHVucmVhZE1zZ0lkcyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgaXRlbXMgPSByZXNwb25zZS5kYXRhLml0ZW1zOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNbaV0uVUZfUkVBRF9VU0VSX0lEX05FVykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zW2ldLlVGX1JFQURfVVNFUl9JRF9ORVcgPSBpdGVtc1tpXS5VRl9SRUFEX1VTRVJfSURfTkVXLnNwbGl0KCcsJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWl0ZW1zW2ldLlVGX1JFQURfVVNFUl9JRF9ORVcgfHwgIX5pdGVtc1tpXS5VRl9SRUFEX1VTRVJfSURfTkVXLmluZGV4T2YoK3RoaXMudXNlckRhdGEuSUQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5yZWFkTXNnSWRzLnB1c2goaXRlbXNbaV0uSUQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBpdGVtczsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVucmVhZE1zZ0lkcy5sZW5ndGggJiYgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoYXQtYm9keScpLm9mZnNldFBhcmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRNZXNzYWdlc1JlYWQodW5yZWFkTXNnSWRzLCB0aGlzLnVzZXJEYXRhLlhNTF9JRCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kc2V0KHRoaXMsICd2YWx1ZXMnLCByZXNwb25zZS5kYXRhLnZhbHVlcyk7CiAgICAgICAgICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YS5tZXNzYWdlcykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVucmVhZE1zZyA9IHJlc3BvbnNlLmRhdGEubWVzc2FnZXM7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKHRoaXMudmFsdWVzLlVGX1RZUEUgPT0gJ9Cg0LXQutC70LDQvNCw0YbQuNGPJykgewogICAgICAgICAgICAgICAgICAgICAgICBCWC5hamF4LnJ1bkNvbXBvbmVudEFjdGlvbigneHBhZ2U6YWpheCcsICdnZXRTdGFmZkxpc3QnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlIDogJ2NsYXNzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyIDogJ9Cc0LXQvdC10LTQttC10YAg0YDQtdC60LvQsNC80LDRhtC40L7QvdC90L7Qs9C+INC+0YLQtNC10LvQsCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXJzRmlsdGVyZWQgPSByZXNwb25zZS5kYXRhLnVzZXJzLkZJTFRFUkVEOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXNlcnNBbGwgPSByZXNwb25zZS5kYXRhLnVzZXJzLkFMTDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnZhbHVlcy5VRl9UWVBFID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgQlguYWpheC5ydW5Db21wb25lbnRBY3Rpb24oJ3hwYWdlOmFqYXgnLCAnZ2V0U3RhZmZMaXN0JywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZSA6ICdjbGFzcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhIDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlciA6ICfQntGC0LLQtdGC0YHRgtCy0LXQvdC90YvQuSDQv9C+INC30LDQv9GA0L7RgdCw0LwnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51c2Vyc0ZpbHRlcmVkID0gcmVzcG9uc2UuZGF0YS51c2Vycy5GSUxURVJFRDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXJzQWxsID0gcmVzcG9uc2UuZGF0YS51c2Vycy5BTEw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEJYLmFqYXgucnVuQ29tcG9uZW50QWN0aW9uKCd4cGFnZTphamF4JywgJ2dldFN0YWZmTGlzdCcsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGUgOiAnY2xhc3MnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIgOiAn0JzQtdC90LXQtNC20LXRgCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXJzRmlsdGVyZWQgPSByZXNwb25zZS5kYXRhLnVzZXJzLkZJTFRFUkVEOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXNlcnNBbGwgPSByZXNwb25zZS5kYXRhLnVzZXJzLkFMTDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgfSwKICAgICAgICBzZXRNZXNzYWdlc1JlYWQgKGlkID0gW10sIHVzZXJfeG1sKSB7CiAgICAgICAgICAgIGlmIChpZC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIEJYLmFqYXgucnVuQ29tcG9uZW50QWN0aW9uKCd4cGFnZTphamF4JywgJ2NoYXRTZXRNZXNzYWdlc1JlYWQnLCB7CiAgICAgICAgICAgICAgICAgICAgbW9kZSA6ICdjbGFzcycsCiAgICAgICAgICAgICAgICAgICAgZGF0YSA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQsIHVzZXJfeG1sLCAKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiB7CgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFkZE1lc3NhZ2UgKCkgewogICAgICAgICAgICBpZih0aGlzLnVzZXJSZWNpdmUgPT0gJycpIHsKICAgICAgICAgICAgICAgIGFsZXJ0KCfQktGL0LHQtdGA0LjRgtC1INC/0L7Qu9GD0YfQsNGC0LXQu9GPINGB0L7QvtCx0YnQtdC90LjRjyEnKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnRleHQgPT0gJycpIHsKICAgICAgICAgICAgICAgIGFsZXJ0KCfQktCy0LXQtNC40YLQtSDRgtC10LrRgdGCINGB0L7QvtCx0YnQtdC90LjRjyEnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxldCBmaWxlSW5wdXQgPSB0aGlzLiRlbC5xdWVyeVNlbGVjdG9yKCcjY2hhdC1maWxlJyk7CiAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IG5ldyBGb3JtRGF0YTsKICAgICAgICAgICAgICAgIGRhdGEuYXBwZW5kKCdvcmRlcklkJywgdGhpcy5vcmRlcklkKTsKICAgICAgICAgICAgICAgIGRhdGEuYXBwZW5kKCdjbGFpbUlkJywgdGhpcy5jbGFpbUlkKTsKICAgICAgICAgICAgICAgIGRhdGEuYXBwZW5kKCd0ZXh0JywgdGhpcy50ZXh0KTsKICAgICAgICAgICAgICAgIGlmKHRoaXMuc3ViamVjdCA9PSAnJykgewogICAgICAgICAgICAgICAgICAgIGRhdGEuYXBwZW5kKCdzdWJqZWN0JywgdGhpcy50ZXh0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YS5hcHBlbmQoJ3N1YmplY3QnLCB0aGlzLnN1YmplY3QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGF0YS5hcHBlbmQoJ3VzZXJSZWNpdmUnLCB0aGlzLnVzZXJSZWNpdmUpOwogICAgICAgICAgICAgICAgZGF0YS5hcHBlbmQoJ21lc3NhZ2VTZWxlY3QnLCB0aGlzLm1lc3NhZ2VTZWxlY3QpOwogICAgICAgICAgICAgICAgaWYgKGZpbGVJbnB1dC5maWxlcyAmJiBmaWxlSW5wdXQuZmlsZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaWxlSW5wdXQuZmlsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5hcHBlbmQoJ2ZpbGVbXScsIGZpbGVJbnB1dC5maWxlc1tpXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgQlguYWpheC5ydW5Db21wb25lbnRBY3Rpb24oJ3hwYWdlOmFqYXgnLCAnY2hhdEFkZE1lc3NhZ2UnLCB7CiAgICAgICAgICAgICAgICAgICAgbW9kZSA6ICdjbGFzcycsCiAgICAgICAgICAgICAgICAgICAgZGF0YSwKICAgICAgICAgICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMudGV4dCA9ICcnOwogICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZERhdGEoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRyZWZzLnRleHRBcmVhLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmVwYXJlZEZpbGVzID0gW107CiAgICAgICAgICAgICAgICAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7CiAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VyUmVjaXZlID0gJycsCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlU2VsZWN0ID0gJyc7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdWJqZWN0ID0gJyc7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlU2VsZWN0VGV4dCA9ICcnOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgfSwKICAgICAgICBzZWxlY3RNZXNzYWdlIChlKSB7CiAgICAgICAgICAgIHRoaXMubWVzc2FnZVNlbGVjdCA9IGUuY3VycmVudFRhcmdldC5wYXJlbnROb2RlLmdldEF0dHJpYnV0ZSgnZGF0YS1tZXNzYWdlJyk7CiAgICAgICAgICAgIHRoaXMudXNlclJlY2l2ZSA9IGUuY3VycmVudFRhcmdldC5wYXJlbnROb2RlLmdldEF0dHJpYnV0ZSgnZGF0YS1hdXRob3InKTsKICAgICAgICAgICAgdGhpcy5tZXNzYWdlU2VsZWN0VGV4dCA9IGUuY3VycmVudFRhcmdldC5wcmV2aW91c1NpYmxpbmcuaW5uZXJIVE1MLnJlcGxhY2UoLzxcLz9bXj5dKyg+fCQpL2csICIiKTsKICAgICAgICAgICAgbGV0IHN1YmplY3RTdWJqZWN0ID0gZS5jdXJyZW50VGFyZ2V0LnBhcmVudE5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLXN1YmplY3QnKTsKICAgICAgICAgICAgbGV0IHN1YmplY3RUZXh0ID0gZS5jdXJyZW50VGFyZ2V0LnBhcmVudE5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLXRleHQnKTsKICAgICAgICAgICAgbGV0IHN1YmplY3QgPSBzdWJqZWN0U3ViamVjdCA/IHN1YmplY3RTdWJqZWN0IDogc3ViamVjdFRleHQ7CiAgICAgICAgICAgIHRoaXMuc3ViamVjdCA9ICdSZTogJyArIHN1YmplY3Q7CiAgICAgICAgICAgICQoJyNzdGFmZi1zZWxlY3QnKS5lbXB0eSgpOwogICAgICAgICAgICBCWC5hamF4LnJ1bkNvbXBvbmVudEFjdGlvbigneHBhZ2U6YWpheCcsICdnZXRVc2VyJywgewogICAgICAgICAgICAgICAgbW9kZSA6ICdjbGFzcycsCiAgICAgICAgICAgICAgICBkYXRhIDogewogICAgICAgICAgICAgICAgICAgIHVzZXJfY29kZSA6IHRoaXMudXNlclJlY2l2ZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgICAgICAgICAgIGxldCBuZXdPcHRpb24gPSBuZXcgT3B0aW9uKHJlc3BvbnNlLmRhdGEuTkFNRSwgcmVzcG9uc2UuZGF0YS5YTUxfSUQpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGFmZi1zZWxlY3QnKS5hcHBlbmQobmV3T3B0aW9uKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgIH0sCiAgICAgICAgcmVzZXRGb3JtKCkgewogICAgICAgICAgICB0aGlzLm1lc3NhZ2VTZWxlY3QgPSAnJzsKICAgICAgICAgICAgdGhpcy51c2VyUmVjaXZlID0gJyc7CiAgICAgICAgICAgIHRoaXMubWVzc2FnZVNlbGVjdFRleHQgPSAnJzsKICAgICAgICAgICAgdGhpcy5zdWJqZWN0ID0gJyc7CiAgICAgICAgICAgICQoJyNzdGFmZi1zZWxlY3QnKS5lbXB0eSgpOwogICAgICAgICAgICBsZXQgbmV3T3B0aW9uID0gbmV3IE9wdGlvbign0JLRi9Cx0LXRgNC40YLQtSDQv9C+0LvRg9GH0LDRgtC10LvRjycsICcnKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YWZmLXNlbGVjdCcpLmFwcGVuZChuZXdPcHRpb24pOwogICAgICAgICAgICAkLmVhY2godGhpcy51c2Vyc0ZpbHRlcmVkLCBmdW5jdGlvbihpbmRleCwgdXNlcikgewogICAgICAgICAgICAgICAgbGV0IG5ld09wdGlvbiA9IG5ldyBPcHRpb24odXNlci5OQU1FLCB1c2VyLlhNTF9JRCk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhZmYtc2VsZWN0JykuYXBwZW5kKG5ld09wdGlvbik7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgY2hlY2tPcmRlcihvcmRlcklELCBjbGFpbUlEKSB7CiAgICAgICAgICAgIGlmKG9yZGVySUQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAnL2xrL29yZGVycy8/aWQ9JyArIG9yZGVySUQ7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2xhaW1JRCkgewogICAgICAgICAgICAgICAgcmV0dXJuICcvbGsvY2xhaW1zLz9pZD0nICsgb3JkZXJJRDsKICAgICAgICAgICAgfSAKICAgICAgICB9LAogICAgICAgIGNoZWNrT3JkZXJOYW1lKG9yZGVySUQsIGNsYWltSUQpIHsKICAgICAgICAgICAgaWYob3JkZXJJRCkgewogICAgICAgICAgICAgICAgcmV0dXJuICfQl9Cw0LrQsNC3IOKElicgKyBvcmRlcklEOwogICAgICAgICAgICB9IGVsc2UgaWYgKGNsYWltSUQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAn0JfQsNC/0YDQvtGBIOKElicgKyBjbGFpbUlEOwogICAgICAgICAgICB9IAogICAgICAgIH0sCiAgICB9LAp9Cg=="},{"version":3,"sources":["Chat.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Chat.vue","sourceRoot":"src/components","sourcesContent":["<template>\n    <div class=\"\">\n        <div class=\"chat-open-btn\">\n            <img src=\"/local/templates/mossman2018/img/ico-chat.svg\" alt=\"\">\n        </div>\n        <div class=\"chat fixed active\">\n            <div v-if=\"unreadMsg  != ''\" class=\"chat-unread\">\n                <div class=\"chat-unread-head\">Непрочитанные сообщения</div>\n                <div class=\"chat-unread-left\">Отправитель</div>\n                <div class=\"chat-unread-right\">Документ</div>\n                <a v-for=\"item in unreadMsg\" :key=\"item.ID\" :href=\"checkOrder(item.ORDER_ID, item.CLAIM_ID)\" class=\"chat-unread__msg\">\n                    <div class=\"chat-unread__msg-sender\">{{ item.USER_NAME }}</div>\n                    <div class=\"chat-unread__msg-order\">{{ checkOrderName(item.ORDER_SEC_ID, item.CLAIM_SEC_ID) }}</div>\n                </a>\n            </div>\n            <div class=\"chat-header\">\n                <div class=\"chat-title\">Сообщения</div>\n                <div class=\"chat-btn\">\n                    <div class=\"chat-toggle\"><img src=\"/local/templates/mossman2018/img/ico-toggle-chat.svg\" alt=\"\"></div>\n                    <div class=\"chat-close\"><img src=\"/local/templates/mossman2018/img/ico-close-chat.svg\" alt=\"\"></div>\n                </div>\n            </div>\n            <div class=\"chat-body\">\n                <div class=\"chat-content\">\n                    <div v-for=\"(dateItems, date) in itemsByDate\" :key=\"date\" class=\"chat-items\">\n                        <div class=\"chat-date\"><span>{{ date }}</span></div>\n                        <div v-for=\"item in dateItems\" :key=\"item.ID\"\n                        class=\"chat-item\"\n                        :data-message=\"item.UF_CODE\"\n                        :data-author=\"item.UF_USER_CODE\"\n                        :data-subject=\"item.UF_SUBJECT\"\n                        :data-text=\"item.UF_TEXT\"\n                        :class=\"{\n                            'message-in' : item.UF_USER_ID != userData.ID && item.UF_USER_CODE != userData.XML_ID,\n                            'message-out' : item.UF_USER_ID == userData.ID || item.UF_USER_CODE == userData.XML_ID,\n                            'selected' : item.UF_CODE == messageSelect,\n                            }\"\n                            >\n                            <div class=\"sender-name color-text\">{{ [ item.USER_LAST_NAME, item.NAME, item.USER_SECOND_NAME, ].filter(v=>v).join(' ') }}</div>\n                            <div class=\"message-subject\"><div class=\"message-subject-head\">Тема: </div>{{ item.UF_SUBJECT }}</div>\n                            <div class=\"message-text\">\n                                {{ item.UF_TEXT }}\n                                <div v-if=\"item.files && item.files.length\" class=\"message-attach\">\n                                    <div v-for=\"file in item.files\" :key=\"file.id\" class=\"message-attach__item\">\n                                        <a :href=\"file.src\" target=\"_blank\" >{{ file.filename }}</a>\n                                    </div>\n                                </div>\n                            </div>\n                            <div v-if=\"item.UF_USER_ID != userData.ID && item.UF_USER_CODE != userData.XML_ID\" @click=\"selectMessage\" class=\"message-reply\">Ответить</div>\n                            <div class=\"message-time\"><span>{{ item.timeFormat }}</span></div>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"chat-footer\">\n                    <div class=\"messenger-subject messenger-reply\">\n                        <div @click=\"resetForm\" class=\"chat-footer-reset-form\"></div>\n                        <label for=\"messenger-reply\">Первичное сообщение:</label>\n                        <input type=\"text\" id=\"messenger-reply\" name=\"messenger-reply\" :value=\"messageSelectText\" placeholder=\"Нажмите на сообщение для его выбора\" disabled>\n                    </div>\n                    <div class=\"messenger-staff-select\">\n                        <label for=\"staff-select\">Получатель:</label>\n                        <select name=\"staff-select\" id=\"staff-select\" v-model=\"userRecive\">\n                            <option value>Выберите получателя</option>\n                            <option v-for=\"user in this.usersFiltered\" v-bind:key=\"user.ID\" v-bind:value=\"user.XML_ID\">{{ user.NAME }}</option>\n                        </select>\n                    </div>\n                    <div class=\"messenger-subject\">\n                        <label for=\"messenger-subject-text\">Тема сообщения:</label>\n                        <input type=\"text\" id=\"messenger-subject-text\" v-model=\"subject\" name=\"messenger-subject-text\" placeholder=\"Напишите тему сообщения\">\n                    </div>\n                    <div class=\"messenger-textarea-wrap\">\n                        <div class=\"messenger-textarea\">\n                            <editable ref=\"textArea\" :content=\"text\" @update=\"text = $event\" class=\"messenger-textarea-input\" @keyup-enter=\"addMessage()\" ></editable>\n                            <span class=\"messenger-placeholder\">Оставьте комментарий...</span>\n                        </div>\n                        <label for=\"chat-file\" class=\"send-photo\">\n                            <img src=\"/local/templates/mossman2018/img/ico-photo-chat.svg\" alt=\"\">\n                        </label>\n                        <input @change=\"preparedFiles = $event.target.files\" id=\"chat-file\" multiple type=\"file\" style=\"display: none;\" />\n                    </div>\n                    <div @click.prevent=\"addMessage()\" class=\"send-message\">\n                        <img src=\"/local/templates/mossman2018/img/ico-send-chat.svg\" alt=\"\">\n                    </div>\n                    <div v-if=\"preparedFiles.length\" class=\"messenger-prepared-files\" >\n                        <div v-for=\"file in preparedFiles\" :key=\"file.lastModified\" class=\"messenger-prepared-files\" >\n                            {{ file.name }}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\n\nimport moment from 'moment';\nmoment.locale('ru');\nwindow.moment = moment;\n\nexport default {\n    name : 'Chat',\n    props : {\n        claimId : {\n            type : Number,\n            default : 0,\n        },\n        orderId : {\n            type : Number,\n            default : 0,\n        },\n        userData : {\n            type : Object,\n            default : () => ({}),\n        },\n    },\n    data : () => ({\n        preparedFiles : [],\n        items : [],\n        subject : '',\n        userRecive : '',\n        text : '',\n        values : {\n            UF_TYPE : '',\n            UF_CONTRACTOR : '',\n            UF_PRIMARY_ORDER : '',\n            UF_3CAD_SERVER_NUM : '',\n            UF_3CAD_SERVER_DATE : '',\n            UF_MODEL : '',\n            UF_SHIPMENT_ADDRESS : '',\n            UF_TRANSPORT_COMPANY : '',\n            UF_COMMENT : '',\n            UF_FACTORY_TITLE : '',\n            UF_SUM : '',\n            UF_ACCEPT_MNGR_DATE : '',\n            UF_PROCES_MNGR_DATE : '',\n            UF_PROCESS_TECH_DATE : '',\n            UF_INVOICE_NUM : '',\n            UF_INVOICE_DATE : '',\n            UF_INVOICE_SUM : '',\n            UF_INVOICE_ACPT_DATE : '',\n            UF_ACCOUNTING_DATE : '',\n            UF_PLAN_DATE : '',\n            UF_RESPONSIBLE_NAME : '',\n            UF_RESPONSIBLE_PHONE : '',\n            UF_STATUS : '',\n            UF_ACCEPTED_MANAGER : '',\n            UF_PROCESSED_MANAGER : '',\n            UF_PROCESSED_TECH : '',\n            UF_INVOICE_NAME : '',\n            UF_INVOICE_ACPT_NAME : '',\n            UF_ACCOUNTING_NAME : '',\n            UF_CONTRACTOR_CODE : '',\n            UF_INNER_CODE : '',\n            UF_3CAD_SERVER_NUM_NEW : '',\n            UF_CANCELED : 0,\n            UF_PAUSED : 0,\n        },\n        usersFiltered : '',\n        usersAll: '',\n        messageSelect : '',\n        messageSelectText : '',\n        userSelect : '',\n        unreadMsg : '',\n    }),\n    computed : {\n        itemsByDate () {\n            let itemsByDate = {}, item, m, date;\n            for (var i = 0; i < this.items.length; i++) {\n                item = this.items[i];\n                m = moment.unix(item.timestamp);\n                date = m.format('DD MMMM YYYY');\n                if (!itemsByDate[date]) {\n                    itemsByDate[date] = [];\n                }\n                item.timeFormat = m.format('HH:mm');\n                itemsByDate[date].push(item);\n            }\n            return itemsByDate;\n        },\n    },\n    mounted () {\n        setInterval(()=>{\n            this.loadData();\n        },5000);        \n\n        $('.lc-cont').each(function(){\n            var sticky =  $('.chat-open-btn');\n            var stickyWrap = $('.lc-cont')\n\n            $(window).scroll(function(){\n                var nsc = $(document).scrollTop();\n                var bp1 = stickyWrap.offset().top;\n                var bp2 = bp1 + stickyWrap.outerHeight()-$(window).height();\n                if (nsc>bp1) {\n                    sticky.css('position','fixed');\n                    sticky.addClass('fixed');\n                }\n                else {\n                    sticky.css('position','absolute');\n                    sticky.css('top', '0 !important');\n                    sticky.removeClass('fixed');\n                }\n                if (nsc>bp2) {\n                    sticky.css('top', bp2-nsc);\n                }\n                else {\n                    sticky.css('top', '245px');\n                }\n            });\n        });\n\n        $('.chat-open-btn').on('click', function(){\n            $('.chat').toggleClass('active');\n        });\n\n        $('.chat-close').on('click', function(){\n            $('.chat').removeClass('active');\n        });\n\n        $('.chat-toggle').on('click', function(){\n            $('.chat-body').slideToggle();\n        });\n\n        $(window).scroll(function(){\n            let heightToBottomEdge = $(window).scrollTop() + window.innerHeight;\n            let canSeeFooter = heightToBottomEdge > $('.footer').offset().top;\n            if(canSeeFooter && !window.absoluted)\n            {\n                $('.chat').toggleClass('absolute');\n                $('.chat').toggleClass('fixed');\n                window.absoluted=true;\n            }\n\n            if(!canSeeFooter && window.absoluted)\n            {\n                $('.chat').toggleClass('absolute');\n                $('.chat').toggleClass('fixed');\n                window.absoluted=false;\n            }\n\n        });\n    },\n    watch : {\n\t\titems (messages, oldMessages) {\n\t\t\tif (messages.length != oldMessages.length) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.$el.querySelector('.chat-content').scrollTop = this.$el.querySelector('.chat-content').scrollHeight - this.$el.querySelector('.chat-content').clientHeight;\n\t\t\t\t}, 300);\n\t\t\t}\n\t\t},\n    },\n    methods : {\n        loadData () {\n            BX.ajax.runComponentAction('xpage:ajax', 'chatLoadData', {\n                mode : 'class',\n                data : {\n                    claimId : this.claimId,\n                    orderId : this.orderId,\n                    userXML : this.userData.XML_ID,\n                    userID : this.userData.ID\n                },\n            }).then(response => {\n                if (response.data) {\n                    if (response.data.items && response.data.items.length) {\n                        let unreadMsgIds = [];\n                        let items = response.data.items;\n                        for (var i = 0; i < items.length; i++) {\n                            if (items[i].UF_READ_USER_ID_NEW) {\n                                items[i].UF_READ_USER_ID_NEW = items[i].UF_READ_USER_ID_NEW.split(',');\n                            }\n                            if (!items[i].UF_READ_USER_ID_NEW || !~items[i].UF_READ_USER_ID_NEW.indexOf(+this.userData.ID)) {\n                                unreadMsgIds.push(items[i].ID);\n                            }\n                        }\n                    \n                        this.items = items;\n                        if (unreadMsgIds.length && document.querySelector('.chat-body').offsetParent) {\n                            this.setMessagesRead(unreadMsgIds, this.userData.XML_ID);\n                        }\n                    }\n                    this.$set(this, 'values', response.data.values);\n                    if(response.data.messages) {\n                        this.unreadMsg = response.data.messages;\n                    }\n                    if(this.values.UF_TYPE == 'Рекламация') {\n                        BX.ajax.runComponentAction('xpage:ajax', 'getStaffList', {\n                            mode : 'class',\n                            data : {\n                                filter : 'Менеджер рекламационного отдела'\n                            },\n                        }).then(response => {\n                            if (response.data) {\n                                this.usersFiltered = response.data.users.FILTERED;\n                                this.usersAll = response.data.users.ALL;\n                            }\n                        });\n                    } else if (this.values.UF_TYPE == null) {\n                        BX.ajax.runComponentAction('xpage:ajax', 'getStaffList', {\n                            mode : 'class',\n                            data : {\n                                filter : 'Ответственный по запросам'\n                            },\n                        }).then(response => {\n                            if (response.data) {\n                                this.usersFiltered = response.data.users.FILTERED;\n                                this.usersAll = response.data.users.ALL;\n                            }\n                        });\n                    } else {\n                        BX.ajax.runComponentAction('xpage:ajax', 'getStaffList', {\n                            mode : 'class',\n                            data : {\n                                filter : 'Менеджер'\n                            },\n                        }).then(response => {\n                            if (response.data) {\n                                this.usersFiltered = response.data.users.FILTERED;\n                                this.usersAll = response.data.users.ALL;\n                            }\n                        });\n                    }\n                }\n            });\n         },\n        setMessagesRead (id = [], user_xml) {\n            if (id.length) {\n                BX.ajax.runComponentAction('xpage:ajax', 'chatSetMessagesRead', {\n                    mode : 'class',\n                    data : {\n                        id, user_xml, \n                    },\n                }).then(response => {\n\n                });\n            }\n        },\n        addMessage () {\n            if(this.userRecive == '') {\n                alert('Выберите получателя сообщения!');\n            } else if (this.text == '') {\n                alert('Введите текст сообщения!');\n            } else {\n                let fileInput = this.$el.querySelector('#chat-file');\n                let data = new FormData;\n                data.append('orderId', this.orderId);\n                data.append('claimId', this.claimId);\n                data.append('text', this.text);\n                if(this.subject == '') {\n                    data.append('subject', this.text);\n                } else {\n                    data.append('subject', this.subject);\n                }\n                data.append('userRecive', this.userRecive);\n                data.append('messageSelect', this.messageSelect);\n                if (fileInput.files && fileInput.files.length) {\n                    for (var i = 0; i < fileInput.files.length; i++) {\n                        data.append('file[]', fileInput.files[i]);\n                    }\n                }\n                BX.ajax.runComponentAction('xpage:ajax', 'chatAddMessage', {\n                    mode : 'class',\n                    data,\n                }).then(response => {\n                    this.text = '';\n                    this.loadData();\n                    this.$refs.textArea.clear();\n                    this.preparedFiles = [];\n                    fileInput.value = '';\n                    this.userRecive = '',\n                    this.messageSelect = '';\n                    this.subject = '';\n                    this.messageSelectText = '';\n                });\n            }\n            \n        },\n        selectMessage (e) {\n            this.messageSelect = e.currentTarget.parentNode.getAttribute('data-message');\n            this.userRecive = e.currentTarget.parentNode.getAttribute('data-author');\n            this.messageSelectText = e.currentTarget.previousSibling.innerHTML.replace(/<\\/?[^>]+(>|$)/g, \"\");\n            let subjectSubject = e.currentTarget.parentNode.getAttribute('data-subject');\n            let subjectText = e.currentTarget.parentNode.getAttribute('data-text');\n            let subject = subjectSubject ? subjectSubject : subjectText;\n            this.subject = 'Re: ' + subject;\n            $('#staff-select').empty();\n            BX.ajax.runComponentAction('xpage:ajax', 'getUser', {\n                mode : 'class',\n                data : {\n                    user_code : this.userRecive\n                },\n            }).then(response => {\n                if (response.data) {\n                    let newOption = new Option(response.data.NAME, response.data.XML_ID);\n                    document.getElementById('staff-select').append(newOption);\n                }\n            });\n            \n        },\n        resetForm() {\n            this.messageSelect = '';\n            this.userRecive = '';\n            this.messageSelectText = '';\n            this.subject = '';\n            $('#staff-select').empty();\n            let newOption = new Option('Выберите получателя', '');\n            document.getElementById('staff-select').append(newOption);\n            $.each(this.usersFiltered, function(index, user) {\n                let newOption = new Option(user.NAME, user.XML_ID);\n                document.getElementById('staff-select').append(newOption);\n            });\n        },\n        checkOrder(orderID, claimID) {\n            if(orderID) {\n                return '/lk/orders/?id=' + orderID;\n            } else if (claimID) {\n                return '/lk/claims/?id=' + orderID;\n            } \n        },\n        checkOrderName(orderID, claimID) {\n            if(orderID) {\n                return 'Заказ №' + orderID;\n            } else if (claimID) {\n                return 'Запрос №' + claimID;\n            } \n        },\n    },\n}\n</script>\n"]}]}