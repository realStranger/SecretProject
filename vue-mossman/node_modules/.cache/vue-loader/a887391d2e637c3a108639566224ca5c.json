{"remainingRequest":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/src/components/OrderDetail.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/src/components/OrderDetail.vue","mtime":1608549383623},{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCmEuYXJyb3ctYnRuewogICAgY29sb3I6ICNmZmY7Cn0KCi5hcnJvdy1idG57CiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7Cn0KCi5hcnJvdy1idG4tLXNtYWxsewogICAgcGFkZGluZzogN3B4IDhweDsKfQoKLmxjLWluZm8taXRlbV9fYWRkewogICAgbWFyZ2luOiAyNXB4IDAgMDsKfQoKLmxjX19pbmZvLXRhYmxlIGlucHV0Om5vdChbdHlwZV0pLAoubGNfX2luZm8tdGFibGUgaW5wdXRbdHlwZT10ZXh0XXsKICAgIGhlaWdodDogMzBweDsKICAgIHBhZGRpbmc6IDJweCAxMHB4OwogICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tYm9yZGVyQ29sb3IpOwp9CgouY291bnQtaW5wdXR7CiAgICBtYXgtd2lkdGg6IDUwcHg7Cn0KCi5wcmljZS1pbnB1dCwgLnN1bW0taW5wdXR7CiAgICBtYXgtd2lkdGg6IDE0MHB4Owp9Cgoubi13cl9fc2F2ZSwgLm4td3JfX2VkaXQsCi5uLXdyX19yZW1vdmV7CiAgICBtYXJnaW4tdG9wOiAxMHB4OwogICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwp9Cgoubi13cl9fc2F2ZTpub3QoOmxhc3QtY2hpbGQpLCAubi13cl9fZWRpdDpub3QoOmxhc3QtY2hpbGQpLAoubi13cl9fcmVtb3ZlOm5vdCg6bGFzdC1jaGlsZCl7CiAgICBtYXJnaW4tcmlnaHQ6IDEwcHg7Cn0KCg=="},{"version":3,"sources":["OrderDetail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAikBA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"OrderDetail.vue","sourceRoot":"src/components","sourcesContent":["<template>\n    <div v-if=\"dataLoaded\" class=\"lc-body\">\n        <form @submit.prevent=\"save()\" method=\"post\" >\n            <a href=\"/lk/orders/\" class=\"lk-back-link\">Перейти в список заказов</a>\n            <div class=\"lc__top lc-info-top\">\n                <div class=\"order-top-info info-item-group\">\n                    <div class=\"lc-info-item\">\n                        <div class=\"info-tile\">Вид заказа</div>\n                        <select v-model=\"values.UF_TYPE\" required >\n                            <option value=\"\">Выберите из списка</option>\n                            <option>Первичный</option>\n                            <option>Вторичный</option>\n                            <option>Рекламация</option>\n                        </select>\n                    </div>\n                    <div class=\"lc-info-item\">\n                        <div class=\"info-tile\">Контрагент/ юр. лицо</div>\n                        <select v-if=\"userData.distributors.length\" v-model=\"values.UF_CONTRACTOR_CODE\" required >\n                            <option value=\"\">Выберите из списка</option>\n                            <option v-for=\"item in userData.distributors\" :key=\"item.ID\" :value=\"item.UF_CODE\" >{{ item.UF_NAME }}</option>\n                        </select>\n                        <input v-else v-model=\"values.UF_CONTRACTOR\" class=\"info-input w-max\" />\n                    </div>\n                    <div class=\"lc-info-item\">\n                        <div class=\"info-tile\">Внутренний номер</div>\n                        <input v-model=\"values.UF_INNER_CODE\" class=\"info-input w-max\" />\n                    </div>\n                </div>\n                <div class=\"lc__top-status during\"><span class=\"icon\"><img src=\"/local/templates/mossman2018/img/ico-during.svg\" alt=\"\"></span> {{ values.UF_STATUS }}</div>\n            </div>\n            <div class=\"lc__info order-info\">\n                <div class=\"col-left\">\n                    <div class=\"title\">Информация по клиенту</div>\n                    <div class=\"lc-card\">\n                        <div v-if=\"values.UF_TYPE && values.UF_TYPE != 'Первичный'\" class=\"lc-info-item\">\n                            <div class=\"info-tile\">Первичный заказ:</div>\n                            <select @change=\"primaryOrder =''\" v-model=\"sortType\">\n                                <option value=\"Заказ\">Поиск по номеру заказа</option>\n                                <option value=\"Счет\">Поиск по номеру счета</option>\n                            </select>\n                            <div v-if=\"sortType == 'Заказ'\" class=\"primary-orders-select\">\n                                <input type=\"text\" class=\"primary-orders\" @change=\"takeDataCode\" list=\"primary-orders\" v-model=\"primaryOrder\" placeholder=\"Выберите из списка\">\n                                <datalist id=\"primary-orders\">\n                                    <option v-for=\"item in ordersList.filter(o=>o.ID != orderId)\" :key=\"item.ID\" :data-order=\"item.UF_CODE\" >№{{ item.UF_ORDER_NUM }}</option>\n                                </datalist>\n                            </div>\n                            <div v-else class=\"primary-orders-select\">\n                                <input type=\"text\" class=\"primary-orders\" @change=\"takeDataCode\" list=\"primary-orders\" v-model=\"primaryOrder\" placeholder=\"Выберите из списка\">\n                                <datalist id=\"primary-orders\">\n                                    <option v-for=\"item in ordersList.filter(o=>o.ID != orderId)\" :key=\"item.ID\" :data-order=\"item.UF_CODE\" >№{{ item.UF_INVOICE_NUM }}</option>\n                                </datalist>\n                            </div>\n                        </div>\n                        <div class=\"lc-info-item\">\n                            <div class=\"string-item\">\n                                <div class=\"info-tile\">3Cad сервер №</div>\n                                <div class=\"info-input-group\">\n                                    <input v-model=\"values.UF_3CAD_SERVER_NUM_NEW\" class=\"info-input w-min\" />\n                                    <span>от</span>\n                                    <input  @keyup=\"values.UF_3CAD_SERVER_DATE = $event.target.value\" v-model=\"values.UF_3CAD_SERVER_DATE\" class=\"info-input w-min mask--date\" />\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"lc-info-item\">\n                            <div class=\"info-tile\">Модель:</div>\n                            <input v-model=\"values.UF_MODEL\" class=\"info-input w-max\" />\n                        </div>\n                        <div class=\"lc-info-item\">\n                            <div class=\"info-tile\">Список товаров:</div>\n                            <div class=\"info-table table-wrap\">\n                                <table class=\"lc__info-table\">\n                                    <thead>\n                                        <tr>\n                                            <th>Артикул</th>\n                                            <th>Название</th>\n                                            <th>Кол-во</th>\n                                            <th>Цена</th>\n                                            <th>Сумма</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                        <tr v-for=\"(orderProduct, key) in orderProducts\" :key=\"orderProduct.ID\" >\n                                            <td class=\"n-wr\">{{ orderProduct.UF_ARTICLE }}</td>\n                                            <td>\n                                                <template v-if=\"orderProduct.editable\" >\n                                                    <input class=\"name-input\" v-model=\"orderProduct.UF_NAME\" @input=\"searchProducts(orderProduct)\" @change=\"productSelect(orderProduct)\" :list=\"`product-list-${orderProduct.ID}`\">\n                                                    <datalist :id=\"`product-list-${orderProduct.ID}`\">\n                                                        <option v-for=\"variant in orderProduct.variants\" :key=\"variant.ID\" :value=\"variant.UF_NAME\" ></option>\n                                                    </datalist>\n                                                    <div class=\"n-wr__save\">\n                                                        <a class=\"arrow-btn arrow-btn--small\" href=\"#\" @click.prevent=\"productSave(orderProduct)\" >Сохранить</a>\n                                                    </div>\n                                                </template>\n                                                <template v-else >\n                                                    {{ orderProduct.UF_NAME }}\n\n                                                    <div class=\"n-wr__edit\">\n                                                        <a class=\"arrow-btn arrow-btn--small\" href=\"#\" @click.prevent=\"orderProduct.editable = true\" >Редактировать</a>\n                                                    </div>\n                                                </template>\n                                                <div class=\"n-wr__remove\">\n                                                    <a class=\"arrow-btn arrow-btn--small\" href=\"#\" @click.prevent=\"orderProducts.splice(key, 1)\" >Удалить</a>\n                                                </div>\n                                            </td>\n                                            <td class=\"n-wr\">\n                                                <template v-if=\"orderProduct.editable\" >\n                                                    <input class=\"count-input\" v-model=\"orderProduct.UF_QUANTITY\" type=\"text\" @input=\"recalcProductSum(orderProduct)\" />\n                                                </template>\n                                                <template v-else >\n                                                    {{ orderProduct.UF_QUANTITY }} шт\n                                                </template>\n                                            </td>\n                                            <td class=\"n-wr\">\n                                                <template v-if=\"orderProduct.editable\" >\n                                                    <input class=\"price-input\" v-model=\"orderProduct.UF_PRICE\" type=\"text\" @input=\"recalcProductSum(orderProduct)\" />\n                                                </template>\n                                                <template v-else >\n                                                    {{ orderProduct.UF_PRICE }} руб.\n                                                </template>\n                                            </td>\n                                            <td class=\"n-wr\">\n                                                <!-- <template v-if=\"orderProduct.editable\" >\n                                                    <input class=\"summ-input\" v-model=\"orderProduct.UF_SUM\" type=\"text\" />\n                                                </template>\n                                                <template v-else >\n                                                    {{ orderProduct.UF_SUM }} руб.\n                                                </template> -->\n                                                <template v-if=\"orderProduct.UF_SUM\" >\n                                                    {{ orderProduct.UF_SUM }} руб.\n                                                </template>\n                                            </td>\n                                        </tr>\n                                    </tbody>\n                                </table>\n                                <div class=\"lc-info-item__add\">\n                                    <a @click.prevent=\"addProduct()\" class=\"arrow-btn arrow-btn--small\" href=\"#\">Добавить</a>\n                                </div>\n                            </div>\n                        </div>\n                        <!-- <div class=\"lc-info-item\">\n                            <div class=\"info-tile\">Адрес отгрузки:</div>\n                            <input v-model=\"values.UF_SHIPMENT_ADDRESS\" class=\"info-input w-min\" />\n                        </div>\n                        <div class=\"lc-info-item\">\n                            <div class=\"info-tile\">Транспортная компания:</div>\n                            <input v-model=\"values.UF_TRANSPORT_COMPANY\" class=\"info-input w-min\" />\n                        </div> -->\n                        <div class=\"lc-info-item\">\n                            <div class=\"info-tile\">Комментарий:</div>\n                            <input v-model=\"values.UF_COMMENT\" class=\"info-input w-max\" />\n                        </div>\n                        <div class=\"lc-info-item\">\n                            <div class=\"info-tile\">Файлы:</div>\n                            <div class=\"\">\n                                <div class=\"\">\n                                    <div class=\"\">\n\n                                    </div>\n                                    <div class=\"default-input default-input--file\" style=\"width: 200px;\">\n                                        <input class=\"default-input__input default-input__input--file\" ref=\"OrderFiles\" @change=\"fileInputChanged($event.target)\" type=\"file\" multiple id=\"price-file\" />\n                                        <div class=\"default-input__input-filetext\" style=\"margin-bottom: 20px;\">\n                                            <input class=\"default-input__input\" type=\"text\" readonly=\"\" placeholder=\"Прикрепить файл +\">\n                                            <label for=\"price-file\" class=\"default-input__label--file\"></label>\n                                        </div>\n                                        <div v-if=\"orderFiles.length\" >\n                                            {{ Array.prototype.map.call(orderFiles, orderFile => orderFile.name).join(', ') }}\n                                        </div>\n                                    </div>\n                                    <div class=\"\" style=\"margin-top: 20px;\">\n                                        Доступные форматы: jpg, png, gif, pdf, doc, docx, rtf, txt\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <div v-if=\"values.files && values.files.length\" class=\"lc-info-item\">\n                            <div class=\"info-tile\">Загруженные файлы:</div>\n                            <div class=\"\">\n                                <div v-for=\"file in values.files\" :key=\"file.ID\" class=\"\">\n                                    <a :href=\"file.SRC\" target=\"_blank\" >{{ file.ORIGINAL_NAME }}</a>\n                                    <a @click.prevent=\"fileRemove(file)\" class=\"delete-file-order\" href=\"#\" >удалить</a>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-right\">\n                    <div class=\"title\">Информация по заказу</div>\n                    <div class=\"lc-card\">\n                        <div class=\"info-item-group\">\n                            <div class=\"lc-info-item b-item\">\n                                <div class=\"info-tile\">Заказ фабрики:</div>\n                                <div class=\"info-input\" >{{ values.UF_FACTORY_TITLE }}</div>\n                            </div>\n                            <div class=\"lc-info-item\">\n                                <div class=\"info-tile\">сумма:</div>\n                                <div class=\"info-input w-min total\" >{{ values.UF_SUM }}</div>\n                            </div>\n                        </div>\n                        <div class=\"lc-info-item item-wrap\">\n                            <div v-if=\"+values.UF_CANCELED\" class=\"string-item\">\n                                <div class=\"info-tile\">Аннулирован</div>\n                            </div>\n                            <div v-if=\"+values.UF_PAUSED\" class=\"string-item\">\n                                <div class=\"info-tile\">Приостановлен</div>\n                            </div>\n                            <div v-if=\"values.UF_ACCEPTED_MANAGER\" class=\"string-item\">\n                                <div class=\"info-tile\">Принят менеджером:</div>\n                                <div class=\"info-input-group\">\n                                    <div class=\"info-input w-min\" >{{ values.UF_ACCEPT_MNGR_DATE }}</div>\n                                    <span>{{ values.UF_ACCEPTED_MANAGER }}</span>\n                                </div>\n                            </div>\n                            <div class=\"string-item\">\n                                <div class=\"info-tile\">Обработан менеджером:</div>\n                                <div class=\"info-input-group\">\n                                    <div class=\"info-input w-min\" >{{ values.UF_PROCES_MNGR_DATE }}</div>\n                                    <span>{{ values.UF_PROCESSED_MANAGER }}</span>\n                                </div>\n                            </div>\n                            <div class=\"string-item\">\n                                <div class=\"info-tile\">Обработан технологом:</div>\n                                <div class=\"info-input-group\">\n                                    <div class=\"info-input w-min\" >{{ values.UF_PROCESS_TECH_DATE }}</div>\n                                    <span>{{ values.UF_PROCESSED_TECH }}</span>\n                                </div>\n                            </div>\n                            <div class=\"string-item\">\n                                <div class=\"info-tile\">Выставлен счет №</div>\n                                <div class=\"info-input-group\">\n                                    <div class=\"info-input w-min\" >{{ values.UF_INVOICE_NUM }}</div>\n                                    <div class=\"info-input w-min\" >{{ values.UF_INVOICE_DATE }}</div>\n                                    <div class=\"info-input w-min total\" >{{ values.UF_INVOICE_SUM }}</div>\n                                    <span>{{ values.UF_INVOICE_NAME }}</span>\n                                </div>\n                            </div>\n                            <div v-if=\"values.invoiceFile && values.invoiceFile.length\" class=\"string-item\">\n                                <div class=\"info-tile\">Бланк счёта</div>\n                                <div class=\"info-input-group\">\n                                    <div v-for=\"f in values.invoiceFile\" :key=\"f.ID\" >\n                                        <a :href=\"f.SRC\" download >{{ f.ORIGINAL_NAME }}</a>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class=\"string-item\">\n                                <div class=\"info-tile\">оплачено:</div>\n                                <div class=\"info-input-group\">\n                                    <div class=\"info-input w-min paid\" >{{ values.UF_PAYED_SUM }}</div>\n                                    <!-- <span class=\"color-text\">Частичная оплата</span> -->\n                                </div>\n                            </div>\n                            <div class=\"string-item\">\n                                <div class=\"info-tile\">Счет принят:</div>\n                                <div class=\"info-input-group\">\n                                    <input @keyup=\"values.UF_INVOICE_ACPT_DATE = $event.target.value\" v-model=\"values.UF_INVOICE_ACPT_DATE\" type=\"text\" class=\"info-input mask--date w-min\" />\n                                    <span>{{ values.UF_INVOICE_ACPT_NAME }}</span>\n                                    <a href=\"#\" @click.prevent=\"values.UF_INVOICE_ACPT_DATE = (values.UF_INVOICE_ACPT_DATE?'':curDate)\" class=\"arrow-btn\" >{{ !values.UF_INVOICE_ACPT_DATE?'Принять счёт':'Отменить приёмку счёта' }}</a>\n                                </div>\n                            </div>\n                            <div class=\"string-item\">\n                                <div class=\"info-tile\">Выписаны бух. документы:</div>\n                                <div class=\"info-input-group\">\n                                    <div class=\"info-input w-min\" >{{ values.UF_ACCOUNTING_DATE }}</div>\n                                    <span>{{ values.UF_ACCOUNTING_NAME }}</span>\n                                </div>\n                            </div>\n                            <div class=\"string-item\">\n                                <div class=\"info-tile color-text-2\">Плановая дата готовности:</div>\n                                <div class=\"info-input-group\">\n                                    <div class=\"info-input w-min color-text-2\" >{{ values.UF_PLAN_DATE }}</div>\n                                    <!-- <span>Срок исполнения — 40 рабочих дней от 26.12.2018</span> -->\n                                </div>\n                            </div>\n                            <div class=\"string-item\">\n                                <div class=\"info-tile\">Ответственный:</div>\n                                <div class=\"info-input-group\">\n                                    <div class=\"info-input b-input\" >{{ values.UF_RESPONSIBLE_NAME }}</div>\n                                </div>\n                            </div>\n                            <div class=\"string-item\">\n                                <div class=\"info-tile\">Телефон:</div>\n                                <div class=\"info-input-group\">\n                                    <div class=\"info-input b-input\" >{{ values.UF_RESPONSIBLE_PHONE }}</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <button type=\"submit\" class=\"arrow-btn\" name=\"save\" value=\"save\" >Сохранить</button>\n            <button v-if=\"orderId && !+values.UF_CANCELED\" @click.prevent.stop=\"pauseToggle()\" type=\"button\" class=\"arrow-btn\" name=\"save\">{{ !values.UF_PAUSED ? 'Приостановить' : 'Возобновить' }}</button>\n            <button v-if=\"orderId && !+values.UF_CANCELED\" @click.prevent.stop=\"cancel()\" type=\"button\" class=\"arrow-btn\" name=\"save\">Аннулировать</button>\n\n        </form>\n    </div>\n</template>\n\n<script>\nimport moment from 'moment';\nmoment.locale('ru');\nexport default {\n    name: 'OrderDetail',\n    props : {\n        id : {\n            type : Number,\n            default : 0,\n        },\n        userData : {\n            type : Object,\n            default : () => ({}),\n        },\n        ordersList : {\n            type : Array,\n            default : () => ([]),\n        },\n    },\n    mounted () {\n        $(()=>{\n            this.curDate = moment().format('DD.MM.YYYY');\n        });\n        this.orderId = +this.id;\n        if (this.orderId) {\n            this.loadData();\n        }\n        else {\n            if (this.userData.distributors.length) {\n                this.values.UF_CONTRACTOR = this.userData.distributors[0].UF_NAME;\n            }\n            if (this.userData.distributors.length) {\n                this.values.UF_CONTRACTOR_CODE = this.userData.distributors[0].UF_CODE;\n            }\n            this.dataLoaded = true;\n        }\n    },\n    data : () => ({\n        curDate : '',\n        processed : false,\n        orderId : 0,\n        values : {\n            UF_TYPE : '',\n            UF_CONTRACTOR : '',\n            UF_PRIMARY_ORDER : '',\n            UF_3CAD_SERVER_NUM : '',\n            UF_3CAD_SERVER_DATE : '',\n            UF_MODEL : '',\n            UF_SHIPMENT_ADDRESS : '',\n            UF_TRANSPORT_COMPANY : '',\n            UF_COMMENT : '',\n            UF_FACTORY_TITLE : '',\n            UF_SUM : '',\n            UF_ACCEPT_MNGR_DATE : '',\n            UF_PROCES_MNGR_DATE : '',\n            UF_PROCESS_TECH_DATE : '',\n            UF_INVOICE_NUM : '',\n            UF_INVOICE_DATE : '',\n            UF_INVOICE_SUM : '',\n            UF_INVOICE_ACPT_DATE : '',\n            UF_ACCOUNTING_DATE : '',\n            UF_PLAN_DATE : '',\n            UF_RESPONSIBLE_NAME : '',\n            UF_RESPONSIBLE_PHONE : '',\n            UF_STATUS : '',\n            UF_ACCEPTED_MANAGER : '',\n            UF_PROCESSED_MANAGER : '',\n            UF_PROCESSED_TECH : '',\n            UF_INVOICE_NAME : '',\n            UF_INVOICE_ACPT_NAME : '',\n            UF_ACCOUNTING_NAME : '',\n            UF_CONTRACTOR_CODE : '',\n            UF_INNER_CODE : '',\n            UF_3CAD_SERVER_NUM_NEW : '',\n            UF_CANCELED : 0,\n            UF_PAUSED : 0,\n        },\n        orderProducts : [],\n        dataLoaded : false,\n        searchTimeout : null,\n        orderFiles : [],\n        primaryOrder: '',\n        sortType: 'Заказ',\n    }),\n    computed : {\n        contractorCode () {\n            return this.values.UF_CONTRACTOR_CODE;\n        },\n    },\n    watch : {\n        contractorCode (code) {\n            if (code) {\n                let distributor = this.userData.distributors.find(o => o.UF_CODE == code);\n                if (distributor) {\n                    this.values.UF_CONTRACTOR = distributor.UF_NAME;\n                }\n                else {\n                    this.values.UF_CONTRACTOR = '';\n                }\n            }\n            else {\n                this.values.UF_CONTRACTOR = '';\n            }\n        },\n    },\n    methods : {\n        recalcProductSum (product) {\n            console.log(product.UF_QUANTITY);\n            if(product.UF_QUANTITY.includes(',')) {\n                product.UF_QUANTITY = product.UF_QUANTITY.replace(',', '.');\n            }\n            let sum = +product.UF_PRICE * +product.UF_QUANTITY;\n            sum = sum.toFixed(2);\n            product.UF_SUM = sum;\n        },\n        productSelect (product) {\n            if (product.variants && product.variants.length) {\n                let similar = product.variants.filter(variant => variant.UF_NAME == product.UF_NAME);\n                if (similar.length == 1) {\n                    product.UF_PRODUCT_CODE = similar[0].UF_CODE;\n                    product.UF_ARTICLE = similar[0].UF_ARTICLE;\n                    if (!product.UF_PRICE) {\n                        product.UF_PRICE = similar[0].UF_PRICE;\n                    }\n                }\n            }\n        },\n        productSave (product) {\n            this.productSelect(product);\n            product.editable = false;\n        },\n        cancel () {\n            BX.ajax.runComponentAction('xpage:ajax', 'orderCancel', {\n                mode : 'class',\n                data : {\n                    orderId : this.orderId,\n                },\n            }).then(response => {\n                this.loadData();\n            });\n        },\n        pauseToggle () {\n            BX.ajax.runComponentAction('xpage:ajax', 'orderPause', {\n                mode : 'class',\n                data : {\n                    orderId : this.orderId,\n                    paused : +this.values.UF_PAUSED || 0,\n                },\n            }).then(response => {\n                this.loadData();\n            });\n        },\n        fileRemove (file) {\n            if (!file.ID) {\n                return;\n            }\n            BX.ajax.runComponentAction('xpage:ajax', 'orderFileRemove', {\n                mode : 'class',\n                data : {\n                    orderId : this.orderId,\n                    fileId : file.ID,\n                },\n            }).then(response => {\n                this.loadData();\n            });\n        },\n        fileInputChanged (input) {\n            this.orderFiles = this.$refs.OrderFiles.files;\n        },\n        searchProducts (orderProduct) {\n            clearTimeout(this.searchTimeout);\n            orderProduct.UF_ARTICLE = '';\n            orderProduct.UF_PRICE = '';\n            if (orderProduct.variants.length) {\n                let similar = orderProduct.variants.filter(variant => variant.UF_NAME == orderProduct.UF_NAME);\n                if (similar.length == 1) {\n                    orderProduct.UF_PRODUCT_CODE = similar[0].UF_CODE;\n                    orderProduct.UF_ARTICLE = similar[0].UF_ARTICLE;\n                    orderProduct.UF_PRICE = similar[0].UF_PRICE;\n                    return;\n                }\n            }\n            if (orderProduct.UF_NAME.length >= 3) {\n                this.searchTimeout = setTimeout(()=>{\n                    BX.ajax.runComponentAction('xpage:ajax', 'searchProducts', {\n                        mode : 'class',\n                        data : {\n                            name : orderProduct.UF_NAME,\n                        },\n                    }).then(response => {\n                        if (response.data) {\n                            orderProduct.variants = response.data.products;\n                        }\n                    });\n                },1000);\n            }\n        },\n        addProduct () {\n            this.orderProducts.push({\n                ID : '_'+(+new Date),\n                UF_ARTICLE : '',\n                UF_NAME : '',\n                UF_QUANTITY : '',\n                UF_PRICE : '',\n                UF_SUM : '',\n                editable : true,\n                variants : [],\n            });\n        },\n        loadData () {\n            if (!this.orderId) {\n                return;\n            }\n            BX.ajax.runComponentAction('xpage:ajax', 'orderGet', {\n                mode : 'class',\n                data : {\n                    id : this.orderId,\n                },\n            }).then(response => {\n                this.dataLoaded = true;\n                this.orderProducts = [];\n                if (response.data) {\n                    if (response.data.values) {\n                        this.$set(this, 'values', response.data.values);\n                    }\n                    if (response.data.orderProducts) {\n                        this.orderProducts = response.data.orderProducts.map(item => {\n                            item.editable = false;\n                            return item;\n                        });\n                    }\n                }\n            });\n        },\n        save () {\n            if (this.processed) {\n                return;\n            }\n            this.processed = true;\n            let data = new FormData;\n            data.append('id', this.orderId);\n            data.append('values', JSON.stringify(this.values));\n            data.append('products', JSON.stringify(this.orderProducts));\n            if (this.orderFiles.length) {\n                for (var i = 0; i < this.orderFiles.length; i++) {\n                    data.append('files[]', this.orderFiles[i]);\n                }\n            }\n            BX.ajax.runComponentAction('xpage:ajax', 'orderSave', {\n                mode : 'class',\n                data,\n            }).then(response => {\n                this.$refs.OrderFiles.value = '';\n                this.orderFiles = [];\n                if (response.data && +response.data.id) {\n                    if (this.orderId != +response.data.id) {\n                        this.orderId = +response.data.id;\n                        try {\n                            history.pushState({}, '', `${location.pathname}?id=${this.orderId}`);\n                        } catch (e) {\n                            console.log(e);\n                        }\n                    }\n                    this.processed = false;\n                    this.loadData();\n                }\n            });\n        },\n        takeDataCode(e) {\n            let orderId = e.currentTarget.value;\n            $('#primary-orders option').each((index, item) => {\n                if(item.innerHTML == orderId) {\n                    this.values.UF_PRIMARY_ORDER = item.getAttribute('data-order');\n                }\n            });\n        },\n    },\n}\n</script>\n\n<style>\n    a.arrow-btn{\n        color: #fff;\n    }\n\n    .arrow-btn{\n        display: inline-block;\n    }\n\n    .arrow-btn--small{\n        padding: 7px 8px;\n    }\n\n    .lc-info-item__add{\n        margin: 25px 0 0;\n    }\n\n    .lc__info-table input:not([type]),\n    .lc__info-table input[type=text]{\n        height: 30px;\n        padding: 2px 10px;\n        border: 1px solid var(--borderColor);\n    }\n\n    .count-input{\n        max-width: 50px;\n    }\n\n    .price-input, .summ-input{\n        max-width: 140px;\n    }\n\n    .n-wr__save, .n-wr__edit,\n    .n-wr__remove{\n        margin-top: 10px;\n        display: inline-block;\n    }\n\n    .n-wr__save:not(:last-child), .n-wr__edit:not(:last-child),\n    .n-wr__remove:not(:last-child){\n        margin-right: 10px;\n    }\n\n</style>\n"]}]}