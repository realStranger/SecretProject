{"remainingRequest":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/src/components/ClaimDetail.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/src/components/ClaimDetail.vue","mtime":1605101377204},{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/bokus/Desktop/secretproject/bitrix/local/vue-mossman/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWUgOiAnQ2xhaW1EZXRhaWwnLAogICAgcHJvcHMgOiB7CiAgICAgICAgaWQgOiB7CiAgICAgICAgICAgIHR5cGUgOiBOdW1iZXIsCiAgICAgICAgICAgIGRlZmF1bHQgOiAwLAogICAgICAgIH0sCiAgICAgICAgdXNlckRhdGEgOiB7CiAgICAgICAgICAgIHR5cGUgOiBPYmplY3QsCiAgICAgICAgICAgIGRlZmF1bHQgOiAoKSA9PiAoe30pLAogICAgICAgIH0sCiAgICB9LAogICAgZGF0YSA6ICgpID0+ICh7CiAgICAgICAgcHJvY2Vzc2VkIDogZmFsc2UsCiAgICAgICAgY2xhaW1JZCA6IDAsCiAgICAgICAgaW52b2ljZUZpbGVzIDogW10sCiAgICAgICAgZmlsZXMgOiBbXSwKICAgICAgICBuZXdGaWxlcyA6IFtdLAogICAgICAgIHZhbHVlcyA6IHsKICAgICAgICAgICAgVUZfTlVNIDogJycsCiAgICAgICAgICAgIFVGX0RBVEVfQURERUQgOiAnJywKICAgICAgICAgICAgVUZfRElTVFJJQlVUT1IgOiAnJywKICAgICAgICAgICAgVUZfVEVYVCA6ICcnLAogICAgICAgICAgICBVRl9SRVNQT05TRSA6ICcnLAogICAgICAgICAgICBVRl9EQVRFX1JFU1BPTlNFIDogJycsCiAgICAgICAgICAgIFVGX1JFU1BPTlNJQkxFX05BTUUgOiAnJywKICAgICAgICAgICAgVUZfQU5TV0VSX05BTUUgOiAnJywKICAgICAgICB9LAogICAgICAgIGRhdGFMb2FkZWQgOiBmYWxzZSwKICAgIH0pLAogICAgbW91bnRlZCAoKSB7CiAgICAgICAgdGhpcy5sb2FkRGF0YSgpCiAgICAgICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy52YWx1ZXMuVUZfRElTVFJJQlVUT1IgJiYgdGhpcy51c2VyRGF0YS5kaXN0cmlidXRvcnMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy52YWx1ZXMuVUZfRElTVFJJQlVUT1IgPSB0aGlzLnVzZXJEYXRhLmRpc3RyaWJ1dG9yc1swXS5VRl9OQU1FOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB0aGlzLmNsYWltSWQgPSArdGhpcy5pZCB8fCAwOwogICAgfSwKICAgIG1ldGhvZHMgOiB7CiAgICAgICAgZmlsZUlucHV0Q2hhbmdlZCAoaW5wdXQpIHsKICAgICAgICAgICAgdGhpcy5uZXdGaWxlcyA9IHRoaXMuJHJlZnMuT3JkZXJGaWxlcy5maWxlczsKICAgICAgICB9LAogICAgICAgIGxvYWREYXRhICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICAgICAgICAgIEJYLmFqYXgucnVuQ29tcG9uZW50QWN0aW9uKCd4cGFnZTphamF4JywgJ2NsYWltR2V0JywgewogICAgICAgICAgICAgICAgICAgIG1vZGUgOiAnY2xhc3MnLAogICAgICAgICAgICAgICAgICAgIGRhdGEgOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkIDogdGhpcy5pZCwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhTG9hZGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS52YWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHNldCh0aGlzLCAndmFsdWVzJywgcmVzcG9uc2UuZGF0YS52YWx1ZXMpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmZpbGVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbGVzID0gcmVzcG9uc2UuZGF0YS5maWxlczsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5pbnZvaWNlRmlsZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW52b2ljZUZpbGVzID0gcmVzcG9uc2UuZGF0YS5pbnZvaWNlRmlsZXM7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgZmlsZVJlbW92ZSAoZmlsZSkgewogICAgICAgICAgICBpZiAoIWZpbGUuSUQpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBCWC5hamF4LnJ1bkNvbXBvbmVudEFjdGlvbigneHBhZ2U6YWpheCcsICdjbGFpbUZpbGVSZW1vdmUnLCB7CiAgICAgICAgICAgICAgICBtb2RlIDogJ2NsYXNzJywKICAgICAgICAgICAgICAgIGRhdGEgOiB7CiAgICAgICAgICAgICAgICAgICAgY2xhaW1JZCA6IHRoaXMuY2xhaW1JZCwKICAgICAgICAgICAgICAgICAgICBmaWxlSWQgOiBmaWxlLklELAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWREYXRhKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgc2F2ZSAoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnByb2Nlc3NlZCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMucHJvY2Vzc2VkID0gdHJ1ZTsKICAgICAgICAgICAgbGV0IGRhdGEgPSBuZXcgRm9ybURhdGE7CiAgICAgICAgICAgIGRhdGEuYXBwZW5kKCdpZCcsIHRoaXMuY2xhaW1JZCk7CiAgICAgICAgICAgIGRhdGEuYXBwZW5kKCd2YWx1ZXMnLCBKU09OLnN0cmluZ2lmeSh0aGlzLnZhbHVlcykpOwogICAgICAgICAgICBpZiAodGhpcy5uZXdGaWxlcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5uZXdGaWxlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGRhdGEuYXBwZW5kKCdmaWxlc1tdJywgdGhpcy5uZXdGaWxlc1tpXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQlguYWpheC5ydW5Db21wb25lbnRBY3Rpb24oJ3hwYWdlOmFqYXgnLCAnY2xhaW1TYXZlJywgewogICAgICAgICAgICAgICAgbW9kZSA6ICdjbGFzcycsCiAgICAgICAgICAgICAgICBkYXRhLAogICAgICAgICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuJHJlZnMuT3JkZXJGaWxlcy52YWx1ZSA9ICcnOwogICAgICAgICAgICAgICAgdGhpcy5uZXdGaWxlcyA9IFtdOwogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgJiYgK3Jlc3BvbnNlLmRhdGEuaWQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jbGFpbUlkICE9ICtyZXNwb25zZS5kYXRhLmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhaW1JZCA9ICtyZXNwb25zZS5kYXRhLmlkOwogICAgICAgICAgICAgICAgICAgICAgICBoaXN0b3J5LnB1c2hTdGF0ZSh7fSwgJycsIGAke2xvY2F0aW9uLnBhdGhuYW1lfT9pZD0ke3RoaXMuY2xhaW1JZH1gKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLmxvYWREYXRhKCk7CiAgICAgICAgICAgICAgICB0aGlzLnByb2Nlc3NlZCA9IGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgfSwKfQo="},{"version":3,"sources":["ClaimDetail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ClaimDetail.vue","sourceRoot":"src/components","sourcesContent":["<template>\n<div class=\"lc-body\">\n    <a href=\"/lk/claims/\" class=\"lk-back-link\">Перейти в список запросов</a>\n    <div v-if=\"dataLoaded\" class=\"lc__info request-info\">\n        <div class=\"lc-card\">\n            <div class=\"lc-card-group\">\n                <div class=\"col-left\">\n                    <div class=\"lc-info-item\">\n                        <div class=\"info-tile\">Номер запроса</div>\n                        <div v-if=\"values.UF_NUM\" class=\"info-input-group\">\n                            <span>{{ values.UF_NUM }} от {{ values.UF_DATE_ADDED }}</span>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"col-right\">\n                    <div class=\"lc-info-item\">\n                        <div class=\"info-tile\">Дистрибьютер</div>\n                        <select v-if=\"userData.distributors.length\" v-model=\"values.UF_DISTRIBUTOR\" required >\n                            <option value=\"\">Выберите из списка</option>\n                            <option v-for=\"item in userData.distributors\" :key=\"item.ID\" >{{ item.UF_NAME }}</option>\n                        </select>\n                        <input v-else v-model=\"values.UF_DISTRIBUTOR\" class=\"info-input\" />\n                    </div>\n                </div>\n            </div>\n            <div class=\"lc-card-group\">\n                <div class=\"col-left\">\n                    <div class=\"lc-info-item\">\n                        <div class=\"info-tile\">запрос</div>\n                        <textarea v-model=\"values.UF_TEXT\" class=\"info-input input-text\" ></textarea>\n                    </div>\n                    <div class=\"lc-info-item\">\n                        <div class=\"info-tile\">Файлы:</div>\n                        <div class=\"\">\n                            <div class=\"\">\n                                <div class=\"\">\n\n                                </div>\n                                <div class=\"default-input default-input--file\" style=\"width: 200px;\">\n                                    <input class=\"default-input__input default-input__input--file\" ref=\"OrderFiles\" @change=\"fileInputChanged($event.target)\" type=\"file\" multiple id=\"price-file\" />\n                                    <div class=\"default-input__input-filetext\" style=\"margin-bottom: 20px;\">\n                                        <input class=\"default-input__input\" type=\"text\" readonly=\"\" placeholder=\"Прикрепить файл +\">\n                                        <label for=\"price-file\" class=\"default-input__label--file\"></label>\n                                    </div>\n                                    <div v-if=\"newFiles.length\" >\n                                        {{ Array.prototype.map.call(newFiles, file => file.name).join(', ') }}\n                                    </div>\n                                </div>\n                                <div class=\"\" style=\"margin-top: 20px;\">\n                                    Доступные форматы: jpg, png, gif, pdf, doc, docx, rtf, txt\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div v-if=\"files.length\" class=\"lc-info-item\">\n                        <div class=\"info-tile\">Загруженные файлы:</div>\n                        <div class=\"\">\n                            <div v-for=\"file in files\" :key=\"file.ID\" class=\"\">\n                                <a :href=\"file.SRC\" target=\"_blank\" >{{ file.ORIGINAL_NAME }}</a>\n                                <a v-if=\"!values.UF_RESPONSE\" @click.prevent=\"fileRemove(file)\" href=\"#\" >удалить</a>\n                            </div>\n                        </div>\n                    </div>\n                    <div v-if=\"invoiceFiles.length\" class=\"lc-info-item\">\n                        <div class=\"info-tile\">Бланк счёта:</div>\n                        <div class=\"\">\n                            <div v-for=\"file in invoiceFiles\" :key=\"file.ID\" class=\"\">\n                                <a :href=\"file.SRC\" target=\"_blank\" >{{ file.ORIGINAL_NAME }}</a>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <!-- <div class=\"col-right\">\n                    <div class=\"lc-info-item\">\n                        <div class=\"info-tile\">номер заказа</div>\n                        <div class=\"info-input-group\">\n                            <div class=\"info-input\"></div>\n                            <span>от</span>\n                            <div class=\"info-input input-date\"></div>\n                        </div>\n                    </div>\n                    <div class=\"lc-info-item\">\n                        <div class=\"info-tile\">заказ</div>\n                        <div class=\"info-input n-wr\"></div>\n                    </div>\n                </div> -->\n            </div>\n        </div>\n        <div v-if=\"values.UF_RESPONSE\" class=\"lc-card request-answer\">\n            <div class=\"lc-info-item\">\n                <div class=\"info-tile\">ответ</div>\n                <div class=\"info-input-group answer-group\">\n                    <div class=\"col-left\">\n                        <div class=\"input-text\" v-html='values.UF_RESPONSE.replace(\"\\n\", \"<br/>\")' ></div>\n                    </div>\n                    <div class=\"col-right\">\n                        <div class=\"answer-info\">\n                            <p v-if=\"values.UF_DATE_RESPONSE\" >Дата ответа: <span n-wr>{{ values.UF_DATE_RESPONSE }}</span></p>\n                            <p v-if=\"values.UF_ANSWER_NAME\">Ответил: <span>{{ values.UF_ANSWER_NAME }}</span></p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <button @click.prevent=\"save()\" type=\"button\" class=\"arrow-btn\" name=\"save\">Сохранить</button>\n    </div>\n</div>\n</template>\n\n<script>\nexport default {\n    name : 'ClaimDetail',\n    props : {\n        id : {\n            type : Number,\n            default : 0,\n        },\n        userData : {\n            type : Object,\n            default : () => ({}),\n        },\n    },\n    data : () => ({\n        processed : false,\n        claimId : 0,\n        invoiceFiles : [],\n        files : [],\n        newFiles : [],\n        values : {\n            UF_NUM : '',\n            UF_DATE_ADDED : '',\n            UF_DISTRIBUTOR : '',\n            UF_TEXT : '',\n            UF_RESPONSE : '',\n            UF_DATE_RESPONSE : '',\n            UF_RESPONSIBLE_NAME : '',\n            UF_ANSWER_NAME : '',\n        },\n        dataLoaded : false,\n    }),\n    mounted () {\n        this.loadData()\n            .then(() => {\n                if (!this.values.UF_DISTRIBUTOR && this.userData.distributors.length) {\n                    this.values.UF_DISTRIBUTOR = this.userData.distributors[0].UF_NAME;\n                }\n            });\n        this.claimId = +this.id || 0;\n    },\n    methods : {\n        fileInputChanged (input) {\n            this.newFiles = this.$refs.OrderFiles.files;\n        },\n        loadData () {\n            return new Promise((resolve, reject) => {\n                BX.ajax.runComponentAction('xpage:ajax', 'claimGet', {\n                    mode : 'class',\n                    data : {\n                        id : this.id,\n                    },\n                }).then(response => {\n                    this.dataLoaded = true;\n                    if (response.data) {\n                        if (response.data.values) {\n                            this.$set(this, 'values', response.data.values);\n                        }\n                        if (response.data.files) {\n                            this.files = response.data.files;\n                        }\n                        if (response.data.invoiceFiles) {\n                            this.invoiceFiles = response.data.invoiceFiles;\n                        }\n                    }\n                    resolve();\n                });\n            });\n        },\n        fileRemove (file) {\n            if (!file.ID) {\n                return;\n            }\n            BX.ajax.runComponentAction('xpage:ajax', 'claimFileRemove', {\n                mode : 'class',\n                data : {\n                    claimId : this.claimId,\n                    fileId : file.ID,\n                },\n            }).then(response => {\n                this.loadData();\n            });\n        },\n        save () {\n            if (this.processed) {\n                return;\n            }\n            this.processed = true;\n            let data = new FormData;\n            data.append('id', this.claimId);\n            data.append('values', JSON.stringify(this.values));\n            if (this.newFiles.length) {\n                for (var i = 0; i < this.newFiles.length; i++) {\n                    data.append('files[]', this.newFiles[i]);\n                }\n            }\n            BX.ajax.runComponentAction('xpage:ajax', 'claimSave', {\n                mode : 'class',\n                data,\n            }).then(response => {\n                this.$refs.OrderFiles.value = '';\n                this.newFiles = [];\n                if (response.data && +response.data.id) {\n                    if (this.claimId != +response.data.id) {\n                        this.claimId = +response.data.id;\n                        history.pushState({}, '', `${location.pathname}?id=${this.claimId}`);\n                    }\n                }\n                this.loadData();\n                this.processed = false;\n            });\n        },\n    },\n}\n</script>\n"]}]}